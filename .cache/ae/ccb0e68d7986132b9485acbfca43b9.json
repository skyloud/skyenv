{"id":"ZHx5","dependencies":[{"name":"/Users/etienne/skyenv/package.json","includedInParent":true,"mtime":1596478551490},{"name":"/Users/etienne/skyenv/node_modules/mongodb/package.json","includedInParent":true,"mtime":1596467161400},{"name":"../utils","loc":{"line":4,"column":34},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/bulk_write.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/utils.js"},{"name":"../core","loc":{"line":5,"column":27},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/bulk_write.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/index.js"},{"name":"./operation","loc":{"line":6,"column":30},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/bulk_write.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/operation.js"}],"generated":{"js":"\"use strict\";const e=require(\"../utils\").applyRetryableWrites,t=require(\"../utils\").applyWriteConcern,n=require(\"../core\").MongoError,o=require(\"./operation\").OperationBase;class r extends o{constructor(e,t,n){super(n),this.collection=e,this.operations=t}execute(o){const r=this.collection,i=this.operations;let s=this.options;r.s.options.ignoreUndefined&&((s=Object.assign({},s)).ignoreUndefined=r.s.options.ignoreUndefined);const d=!0===s.ordered||null==s.ordered?r.initializeOrderedBulkOp(s):r.initializeUnorderedBulkOp(s);let l=!1;try{for(let e=0;e<i.length;e++){const t=Object.keys(i[e])[0];i[e][t].collation&&(l=!0),d.raw(i[e])}}catch(p){return o(p,null)}let c=Object.assign({},s);c=e(c,r.s.db);const u=(c=t(c,{db:r.s.db,collection:r},s)).writeConcern?c.writeConcern:{},a=r.s.topology.capabilities();if(l&&a&&!a.commandsTakeCollation)return o(new n(\"server/primary/mongos does not support collation\"));d.execute(u,c,(e,t)=>{if(!t&&e)return o(e,null);t.insertedCount=t.nInserted,t.matchedCount=t.nMatched,t.modifiedCount=t.nModified||0,t.deletedCount=t.nRemoved,t.upsertedCount=t.getUpsertedIds().length,t.upsertedIds={},t.insertedIds={},t.n=t.insertedCount;const n=t.getInsertedIds();for(let o=0;o<n.length;o++)t.insertedIds[n[o].index]=n[o]._id;const r=t.getUpsertedIds();for(let o=0;o<r.length;o++)t.upsertedIds[r[o].index]=r[o]._id;o(null,t)})}}module.exports=r;"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":3,"column":0},"generated":{"line":1,"column":13}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"applyRetryableWrites","original":{"line":3,"column":6},"generated":{"line":1,"column":19}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"require","original":{"line":3,"column":29},"generated":{"line":1,"column":21}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":3,"column":37},"generated":{"line":1,"column":29}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"applyRetryableWrites","original":{"line":3,"column":49},"generated":{"line":1,"column":41}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"applyWriteConcern","original":{"line":4,"column":6},"generated":{"line":1,"column":62}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"require","original":{"line":4,"column":26},"generated":{"line":1,"column":64}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":4,"column":34},"generated":{"line":1,"column":72}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"applyWriteConcern","original":{"line":4,"column":46},"generated":{"line":1,"column":84}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"MongoError","original":{"line":5,"column":6},"generated":{"line":1,"column":102}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"require","original":{"line":5,"column":19},"generated":{"line":1,"column":104}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":5,"column":27},"generated":{"line":1,"column":112}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"MongoError","original":{"line":5,"column":38},"generated":{"line":1,"column":123}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"OperationBase","original":{"line":6,"column":6},"generated":{"line":1,"column":134}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"require","original":{"line":6,"column":22},"generated":{"line":1,"column":136}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":6,"column":30},"generated":{"line":1,"column":144}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"OperationBase","original":{"line":6,"column":45},"generated":{"line":1,"column":159}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":8,"column":0},"generated":{"line":1,"column":173}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"BulkWriteOperation","original":{"line":8,"column":6},"generated":{"line":1,"column":179}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"OperationBase","original":{"line":8,"column":33},"generated":{"line":1,"column":189}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"constructor","original":{"line":9,"column":2},"generated":{"line":1,"column":191}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collection","original":{"line":9,"column":14},"generated":{"line":1,"column":203}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":9,"column":26},"generated":{"line":1,"column":205}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":9,"column":38},"generated":{"line":1,"column":207}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":10,"column":10},"generated":{"line":1,"column":210}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":10,"column":10},"generated":{"line":1,"column":216}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collection","original":{"line":12,"column":9},"generated":{"line":1,"column":219}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collection","original":{"line":12,"column":9},"generated":{"line":1,"column":224}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collection","original":{"line":12,"column":22},"generated":{"line":1,"column":235}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":13,"column":9},"generated":{"line":1,"column":237}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":13,"column":9},"generated":{"line":1,"column":242}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":13,"column":22},"generated":{"line":1,"column":253}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"execute","original":{"line":16,"column":2},"generated":{"line":1,"column":255}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":16,"column":10},"generated":{"line":1,"column":263}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":17,"column":10},"generated":{"line":1,"column":266}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":17,"column":10},"generated":{"line":1,"column":272}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":17,"column":17},"generated":{"line":1,"column":274}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collection","original":{"line":17,"column":22},"generated":{"line":1,"column":279}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":18,"column":10},"generated":{"line":1,"column":290}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":18,"column":23},"generated":{"line":1,"column":292}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":18,"column":28},"generated":{"line":1,"column":297}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":19,"column":8},"generated":{"line":1,"column":308}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":19,"column":8},"generated":{"line":1,"column":312}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":19,"column":18},"generated":{"line":1,"column":314}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":19,"column":23},"generated":{"line":1,"column":319}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":22,"column":8},"generated":{"line":1,"column":327}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"s","original":{"line":22,"column":13},"generated":{"line":1,"column":329}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":22,"column":15},"generated":{"line":1,"column":331}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"ignoreUndefined","original":{"line":22,"column":23},"generated":{"line":1,"column":339}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":23,"column":6},"generated":{"line":1,"column":358}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"Object","original":{"line":23,"column":16},"generated":{"line":1,"column":360}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"assign","original":{"line":23,"column":23},"generated":{"line":1,"column":367}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":23,"column":30},"generated":{"line":1,"column":374}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":23,"column":34},"generated":{"line":1,"column":377}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"ignoreUndefined","original":{"line":24,"column":14},"generated":{"line":1,"column":381}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":24,"column":32},"generated":{"line":1,"column":397}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"s","original":{"line":24,"column":37},"generated":{"line":1,"column":399}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":24,"column":39},"generated":{"line":1,"column":401}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"ignoreUndefined","original":{"line":24,"column":47},"generated":{"line":1,"column":409}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"bulk","original":{"line":28,"column":10},"generated":{"line":1,"column":426}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"bulk","original":{"line":28,"column":10},"generated":{"line":1,"column":432}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":29,"column":26},"generated":{"line":1,"column":435}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":29,"column":6},"generated":{"line":1,"column":439}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"ordered","original":{"line":29,"column":14},"generated":{"line":1,"column":441}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":29,"column":53},"generated":{"line":1,"column":450}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":29,"column":34},"generated":{"line":1,"column":456}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"ordered","original":{"line":29,"column":42},"generated":{"line":1,"column":458}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":30,"column":10},"generated":{"line":1,"column":466}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"initializeOrderedBulkOp","original":{"line":30,"column":15},"generated":{"line":1,"column":468}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":30,"column":39},"generated":{"line":1,"column":492}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":31,"column":10},"generated":{"line":1,"column":495}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"initializeUnorderedBulkOp","original":{"line":31,"column":15},"generated":{"line":1,"column":497}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":31,"column":41},"generated":{"line":1,"column":523}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collation","original":{"line":34,"column":8},"generated":{"line":1,"column":526}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collation","original":{"line":34,"column":8},"generated":{"line":1,"column":530}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":34,"column":20},"generated":{"line":1,"column":533}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":37,"column":8},"generated":{"line":1,"column":535}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":38,"column":11},"generated":{"line":1,"column":539}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":38,"column":11},"generated":{"line":1,"column":543}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":38,"column":15},"generated":{"line":1,"column":547}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":38,"column":19},"generated":{"line":1,"column":549}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":38,"column":22},"generated":{"line":1,"column":551}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":38,"column":26},"generated":{"line":1,"column":553}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"length","original":{"line":38,"column":37},"generated":{"line":1,"column":555}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":38,"column":45},"generated":{"line":1,"column":562}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":38,"column":50},"generated":{"line":1,"column":566}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"key","original":{"line":40,"column":14},"generated":{"line":1,"column":567}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"key","original":{"line":40,"column":14},"generated":{"line":1,"column":573}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"Object","original":{"line":40,"column":20},"generated":{"line":1,"column":575}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"keys","original":{"line":40,"column":27},"generated":{"line":1,"column":582}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":40,"column":32},"generated":{"line":1,"column":587}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":40,"column":43},"generated":{"line":1,"column":589}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":40,"column":47},"generated":{"line":1,"column":593}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":42,"column":12},"generated":{"line":1,"column":596}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":42,"column":23},"generated":{"line":1,"column":598}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"key","original":{"line":42,"column":26},"generated":{"line":1,"column":601}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collation","original":{"line":42,"column":31},"generated":{"line":1,"column":604}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collation","original":{"line":43,"column":10},"generated":{"line":1,"column":616}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":43,"column":22},"generated":{"line":1,"column":619}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"bulk","original":{"line":47,"column":8},"generated":{"line":1,"column":622}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"raw","original":{"line":47,"column":13},"generated":{"line":1,"column":624}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"operations","original":{"line":47,"column":17},"generated":{"line":1,"column":628}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":47,"column":28},"generated":{"line":1,"column":630}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":49,"column":6},"generated":{"line":1,"column":635}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"err","original":{"line":49,"column":13},"generated":{"line":1,"column":641}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":50,"column":13},"generated":{"line":1,"column":644}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":50,"column":13},"generated":{"line":1,"column":651}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"err","original":{"line":50,"column":22},"generated":{"line":1,"column":653}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":50,"column":27},"generated":{"line":1,"column":655}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":54,"column":8},"generated":{"line":1,"column":661}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":54,"column":8},"generated":{"line":1,"column":665}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"Object","original":{"line":54,"column":23},"generated":{"line":1,"column":667}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"assign","original":{"line":54,"column":30},"generated":{"line":1,"column":674}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":54,"column":37},"generated":{"line":1,"column":681}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":54,"column":41},"generated":{"line":1,"column":684}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":55,"column":4},"generated":{"line":1,"column":687}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"applyRetryableWrites","original":{"line":55,"column":19},"generated":{"line":1,"column":689}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":55,"column":40},"generated":{"line":1,"column":691}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":55,"column":54},"generated":{"line":1,"column":693}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"s","original":{"line":55,"column":59},"generated":{"line":1,"column":695}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"db","original":{"line":55,"column":61},"generated":{"line":1,"column":697}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"writeCon","original":{"line":58,"column":10},"generated":{"line":1,"column":701}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"writeCon","original":{"line":58,"column":10},"generated":{"line":1,"column":707}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":56,"column":4},"generated":{"line":1,"column":710}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"applyWriteConcern","original":{"line":56,"column":19},"generated":{"line":1,"column":712}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":56,"column":37},"generated":{"line":1,"column":714}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":56,"column":51},"generated":{"line":1,"column":716}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"db","original":{"line":56,"column":53},"generated":{"line":1,"column":717}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":56,"column":57},"generated":{"line":1,"column":720}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"s","original":{"line":56,"column":62},"generated":{"line":1,"column":722}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"db","original":{"line":56,"column":64},"generated":{"line":1,"column":724}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collection","original":{"line":56,"column":68},"generated":{"line":1,"column":727}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":56,"column":80},"generated":{"line":1,"column":738}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"options","original":{"line":56,"column":88},"generated":{"line":1,"column":741}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"writeConcern","original":{"line":58,"column":34},"generated":{"line":1,"column":745}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":58,"column":49},"generated":{"line":1,"column":758}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"writeConcern","original":{"line":58,"column":62},"generated":{"line":1,"column":760}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":58,"column":77},"generated":{"line":1,"column":773}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"capabilities","original":{"line":59,"column":10},"generated":{"line":1,"column":776}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"coll","original":{"line":59,"column":25},"generated":{"line":1,"column":778}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"s","original":{"line":59,"column":30},"generated":{"line":1,"column":780}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"topology","original":{"line":59,"column":32},"generated":{"line":1,"column":782}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"capabilities","original":{"line":59,"column":41},"generated":{"line":1,"column":791}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collation","original":{"line":62,"column":8},"generated":{"line":1,"column":806}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"collation","original":{"line":62,"column":8},"generated":{"line":1,"column":809}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"capabilities","original":{"line":62,"column":21},"generated":{"line":1,"column":812}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"capabilities","original":{"line":62,"column":38},"generated":{"line":1,"column":816}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"commandsTakeCollation","original":{"line":62,"column":51},"generated":{"line":1,"column":818}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":63,"column":13},"generated":{"line":1,"column":840}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":63,"column":13},"generated":{"line":1,"column":847}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":63,"column":22},"generated":{"line":1,"column":849}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"MongoError","original":{"line":63,"column":26},"generated":{"line":1,"column":853}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":63,"column":37},"generated":{"line":1,"column":855}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"bulk","original":{"line":67,"column":4},"generated":{"line":1,"column":908}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"execute","original":{"line":67,"column":9},"generated":{"line":1,"column":910}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"writeCon","original":{"line":67,"column":17},"generated":{"line":1,"column":918}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"finalOptions","original":{"line":67,"column":27},"generated":{"line":1,"column":920}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":67,"column":41},"generated":{"line":1,"column":922}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"err","original":{"line":67,"column":42},"generated":{"line":1,"column":923}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":67,"column":47},"generated":{"line":1,"column":925}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":69,"column":10},"generated":{"line":1,"column":930}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":69,"column":11},"generated":{"line":1,"column":934}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"err","original":{"line":69,"column":16},"generated":{"line":1,"column":937}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":70,"column":15},"generated":{"line":1,"column":939}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":70,"column":15},"generated":{"line":1,"column":946}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"err","original":{"line":70,"column":24},"generated":{"line":1,"column":948}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":70,"column":29},"generated":{"line":1,"column":950}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":73,"column":6},"generated":{"line":1,"column":956}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"insertedCount","original":{"line":73,"column":8},"generated":{"line":1,"column":958}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":73,"column":24},"generated":{"line":1,"column":972}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"nInserted","original":{"line":73,"column":26},"generated":{"line":1,"column":974}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":74,"column":6},"generated":{"line":1,"column":984}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"matchedCount","original":{"line":74,"column":8},"generated":{"line":1,"column":986}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":74,"column":23},"generated":{"line":1,"column":999}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"nMatched","original":{"line":74,"column":25},"generated":{"line":1,"column":1001}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":75,"column":6},"generated":{"line":1,"column":1010}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"modifiedCount","original":{"line":75,"column":8},"generated":{"line":1,"column":1012}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":75,"column":24},"generated":{"line":1,"column":1026}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"nModified","original":{"line":75,"column":26},"generated":{"line":1,"column":1028}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":75,"column":39},"generated":{"line":1,"column":1039}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":76,"column":6},"generated":{"line":1,"column":1041}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"deletedCount","original":{"line":76,"column":8},"generated":{"line":1,"column":1043}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":76,"column":23},"generated":{"line":1,"column":1056}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"nRemoved","original":{"line":76,"column":25},"generated":{"line":1,"column":1058}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":77,"column":6},"generated":{"line":1,"column":1067}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upsertedCount","original":{"line":77,"column":8},"generated":{"line":1,"column":1069}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":77,"column":24},"generated":{"line":1,"column":1083}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"getUpsertedIds","original":{"line":77,"column":26},"generated":{"line":1,"column":1085}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"length","original":{"line":77,"column":43},"generated":{"line":1,"column":1102}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":78,"column":6},"generated":{"line":1,"column":1109}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upsertedIds","original":{"line":78,"column":8},"generated":{"line":1,"column":1111}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":78,"column":22},"generated":{"line":1,"column":1123}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":79,"column":6},"generated":{"line":1,"column":1126}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"insertedIds","original":{"line":79,"column":8},"generated":{"line":1,"column":1128}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":79,"column":22},"generated":{"line":1,"column":1140}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":82,"column":6},"generated":{"line":1,"column":1143}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"n","original":{"line":82,"column":8},"generated":{"line":1,"column":1145}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":82,"column":12},"generated":{"line":1,"column":1147}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"insertedCount","original":{"line":82,"column":14},"generated":{"line":1,"column":1149}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"inserted","original":{"line":85,"column":12},"generated":{"line":1,"column":1163}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"inserted","original":{"line":85,"column":12},"generated":{"line":1,"column":1169}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":85,"column":23},"generated":{"line":1,"column":1171}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"getInsertedIds","original":{"line":85,"column":25},"generated":{"line":1,"column":1173}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":87,"column":11},"generated":{"line":1,"column":1190}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":87,"column":11},"generated":{"line":1,"column":1194}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":87,"column":15},"generated":{"line":1,"column":1198}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":87,"column":19},"generated":{"line":1,"column":1200}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":87,"column":22},"generated":{"line":1,"column":1202}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"inserted","original":{"line":87,"column":26},"generated":{"line":1,"column":1204}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"length","original":{"line":87,"column":35},"generated":{"line":1,"column":1206}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":87,"column":43},"generated":{"line":1,"column":1213}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":88,"column":8},"generated":{"line":1,"column":1217}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"insertedIds","original":{"line":88,"column":10},"generated":{"line":1,"column":1219}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"inserted","original":{"line":88,"column":22},"generated":{"line":1,"column":1231}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":88,"column":31},"generated":{"line":1,"column":1233}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"index","original":{"line":88,"column":34},"generated":{"line":1,"column":1236}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"inserted","original":{"line":88,"column":43},"generated":{"line":1,"column":1243}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":88,"column":52},"generated":{"line":1,"column":1245}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"_id","original":{"line":88,"column":55},"generated":{"line":1,"column":1248}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upserted","original":{"line":92,"column":12},"generated":{"line":1,"column":1252}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upserted","original":{"line":92,"column":12},"generated":{"line":1,"column":1258}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":92,"column":23},"generated":{"line":1,"column":1260}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"getUpsertedIds","original":{"line":92,"column":25},"generated":{"line":1,"column":1262}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":94,"column":11},"generated":{"line":1,"column":1279}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":94,"column":11},"generated":{"line":1,"column":1283}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":94,"column":15},"generated":{"line":1,"column":1287}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":94,"column":19},"generated":{"line":1,"column":1289}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":94,"column":22},"generated":{"line":1,"column":1291}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upserted","original":{"line":94,"column":26},"generated":{"line":1,"column":1293}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"length","original":{"line":94,"column":35},"generated":{"line":1,"column":1295}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":94,"column":43},"generated":{"line":1,"column":1302}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":95,"column":8},"generated":{"line":1,"column":1306}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upsertedIds","original":{"line":95,"column":10},"generated":{"line":1,"column":1308}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upserted","original":{"line":95,"column":22},"generated":{"line":1,"column":1320}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":95,"column":31},"generated":{"line":1,"column":1322}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"index","original":{"line":95,"column":34},"generated":{"line":1,"column":1325}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"upserted","original":{"line":95,"column":43},"generated":{"line":1,"column":1332}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"i","original":{"line":95,"column":52},"generated":{"line":1,"column":1334}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"_id","original":{"line":95,"column":55},"generated":{"line":1,"column":1337}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"callback","original":{"line":99,"column":6},"generated":{"line":1,"column":1341}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","original":{"line":99,"column":15},"generated":{"line":1,"column":1343}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"r","original":{"line":99,"column":21},"generated":{"line":1,"column":1348}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"module","original":{"line":104,"column":0},"generated":{"line":1,"column":1354}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"exports","original":{"line":104,"column":7},"generated":{"line":1,"column":1361}},{"source":"../node_modules/mongodb/lib/operations/bulk_write.js","name":"BulkWriteOperation","original":{"line":104,"column":17},"generated":{"line":1,"column":1369}}],"sources":{"../node_modules/mongodb/lib/operations/bulk_write.js":"'use strict';\n\nconst applyRetryableWrites = require('../utils').applyRetryableWrites;\nconst applyWriteConcern = require('../utils').applyWriteConcern;\nconst MongoError = require('../core').MongoError;\nconst OperationBase = require('./operation').OperationBase;\n\nclass BulkWriteOperation extends OperationBase {\n  constructor(collection, operations, options) {\n    super(options);\n\n    this.collection = collection;\n    this.operations = operations;\n  }\n\n  execute(callback) {\n    const coll = this.collection;\n    const operations = this.operations;\n    let options = this.options;\n\n    // Add ignoreUndfined\n    if (coll.s.options.ignoreUndefined) {\n      options = Object.assign({}, options);\n      options.ignoreUndefined = coll.s.options.ignoreUndefined;\n    }\n\n    // Create the bulk operation\n    const bulk =\n      options.ordered === true || options.ordered == null\n        ? coll.initializeOrderedBulkOp(options)\n        : coll.initializeUnorderedBulkOp(options);\n\n    // Do we have a collation\n    let collation = false;\n\n    // for each op go through and add to the bulk\n    try {\n      for (let i = 0; i < operations.length; i++) {\n        // Get the operation type\n        const key = Object.keys(operations[i])[0];\n        // Check if we have a collation\n        if (operations[i][key].collation) {\n          collation = true;\n        }\n\n        // Pass to the raw bulk\n        bulk.raw(operations[i]);\n      }\n    } catch (err) {\n      return callback(err, null);\n    }\n\n    // Final options for retryable writes and write concern\n    let finalOptions = Object.assign({}, options);\n    finalOptions = applyRetryableWrites(finalOptions, coll.s.db);\n    finalOptions = applyWriteConcern(finalOptions, { db: coll.s.db, collection: coll }, options);\n\n    const writeCon = finalOptions.writeConcern ? finalOptions.writeConcern : {};\n    const capabilities = coll.s.topology.capabilities();\n\n    // Did the user pass in a collation, check if our write server supports it\n    if (collation && capabilities && !capabilities.commandsTakeCollation) {\n      return callback(new MongoError('server/primary/mongos does not support collation'));\n    }\n\n    // Execute the bulk\n    bulk.execute(writeCon, finalOptions, (err, r) => {\n      // We have connection level error\n      if (!r && err) {\n        return callback(err, null);\n      }\n\n      r.insertedCount = r.nInserted;\n      r.matchedCount = r.nMatched;\n      r.modifiedCount = r.nModified || 0;\n      r.deletedCount = r.nRemoved;\n      r.upsertedCount = r.getUpsertedIds().length;\n      r.upsertedIds = {};\n      r.insertedIds = {};\n\n      // Update the n\n      r.n = r.insertedCount;\n\n      // Inserted documents\n      const inserted = r.getInsertedIds();\n      // Map inserted ids\n      for (let i = 0; i < inserted.length; i++) {\n        r.insertedIds[inserted[i].index] = inserted[i]._id;\n      }\n\n      // Upserted documents\n      const upserted = r.getUpsertedIds();\n      // Map upserted ids\n      for (let i = 0; i < upserted.length; i++) {\n        r.upsertedIds[upserted[i].index] = upserted[i]._id;\n      }\n\n      // Return the results\n      callback(null, r);\n    });\n  }\n}\n\nmodule.exports = BulkWriteOperation;\n"},"lineCount":null}},"error":null,"hash":"a5109aaadce7ffceddb51ae0da43b66e","cacheData":{"env":{}}}