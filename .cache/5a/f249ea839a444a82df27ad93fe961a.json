{"id":"EXV4","dependencies":[{"name":"/Users/etienne/skyenv/package.json","includedInParent":true,"mtime":1596478551490},{"name":"/Users/etienne/skyenv/node_modules/mongodb/package.json","includedInParent":true,"mtime":1596467161400},{"name":"./command_v2","loc":{"line":3,"column":35},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/list_collections.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/command_v2.js"},{"name":"./operation","loc":{"line":5,"column":30},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/list_collections.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/operation.js"},{"name":"../core/utils","loc":{"line":6,"column":31},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/list_collections.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/utils.js"},{"name":"../constants","loc":{"line":7,"column":26},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/list_collections.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/constants.js"}],"generated":{"js":"\"use strict\";const e=require(\"./command_v2\"),t=require(\"./operation\").Aspect,s=require(\"./operation\").defineAspects,n=require(\"../core/utils\").maxWireVersion,i=require(\"../constants\"),a=3;function c(e){const t=\"\".concat(e,\".\");return{doc:e=>{const s=e.name.indexOf(t);return e.name&&0===s&&(e.name=e.name.substr(s+t.length)),e}}}class o extends e{constructor(e,t,s){super(e,s,{fullResponse:!0}),this.db=e,this.filter=t,this.nameOnly=!!this.options.nameOnly,\"number\"==typeof this.options.batchSize&&(this.batchSize=this.options.batchSize)}execute(e,t){if(n(e)<a){let s=this.filter;const n=this.db.s.namespace.db;\"string\"!=typeof s.name||new RegExp(\"^\"+n+\"\\\\.\").test(s.name)||((s=Object.assign({},s)).name=this.db.s.namespace.withCollection(s.name).toString()),null==s&&(s.name=\"/\".concat(n,\"/\")),s=s.name?{$and:[{name:s.name},{name:/^((?!\\$).)*$/}]}:{name:/^((?!\\$).)*$/};const a=c(n);return void e.query(\"\".concat(n,\".\").concat(i.SYSTEM_NAMESPACE_COLLECTION),{query:s},{batchSize:this.batchSize||1e3},{},(e,s)=>{s&&s.message&&s.message.documents&&Array.isArray(s.message.documents)&&(s.message.documents=s.message.documents.map(a.doc)),t(e,s)})}const s={listCollections:1,filter:this.filter,cursor:this.batchSize?{batchSize:this.batchSize}:{},nameOnly:this.nameOnly};return super.executeCommand(e,s,t)}}s(o,[t.READ_OPERATION,t.RETRYABLE,t.EXECUTE_WITH_SELECTION]),module.exports=o;"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":3,"column":0},"generated":{"line":1,"column":13}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"CommandOperationV2","original":{"line":3,"column":6},"generated":{"line":1,"column":19}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"require","original":{"line":3,"column":27},"generated":{"line":1,"column":21}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":3,"column":35},"generated":{"line":1,"column":29}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"Aspect","original":{"line":4,"column":6},"generated":{"line":1,"column":45}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"require","original":{"line":4,"column":15},"generated":{"line":1,"column":47}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":4,"column":23},"generated":{"line":1,"column":55}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"Aspect","original":{"line":4,"column":38},"generated":{"line":1,"column":70}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"defineAspects","original":{"line":5,"column":6},"generated":{"line":1,"column":77}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"require","original":{"line":5,"column":22},"generated":{"line":1,"column":79}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":5,"column":30},"generated":{"line":1,"column":87}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"defineAspects","original":{"line":5,"column":45},"generated":{"line":1,"column":102}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"maxWireVersion","original":{"line":6,"column":6},"generated":{"line":1,"column":116}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"require","original":{"line":6,"column":23},"generated":{"line":1,"column":118}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":6,"column":31},"generated":{"line":1,"column":126}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"maxWireVersion","original":{"line":6,"column":48},"generated":{"line":1,"column":143}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"CONSTANTS","original":{"line":7,"column":6},"generated":{"line":1,"column":158}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"require","original":{"line":7,"column":18},"generated":{"line":1,"column":160}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":7,"column":26},"generated":{"line":1,"column":168}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"LIST_COLLECTIONS_WIRE_VERSION","original":{"line":9,"column":6},"generated":{"line":1,"column":184}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":9,"column":38},"generated":{"line":1,"column":186}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":11,"column":0},"generated":{"line":1,"column":188}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"listCollectionsTransforms","original":{"line":11,"column":9},"generated":{"line":1,"column":197}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":11,"column":35},"generated":{"line":1,"column":199}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"matching","original":{"line":12,"column":8},"generated":{"line":1,"column":202}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"matching","original":{"line":12,"column":8},"generated":{"line":1,"column":208}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":12,"column":22},"generated":{"line":1,"column":210}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":12,"column":22},"generated":{"line":1,"column":213}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":12,"column":22},"generated":{"line":1,"column":220}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":12,"column":2},"generated":{"line":1,"column":222}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":14,"column":9},"generated":{"line":1,"column":227}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":14,"column":9},"generated":{"line":1,"column":233}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":15,"column":4},"generated":{"line":1,"column":234}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":15,"column":9},"generated":{"line":1,"column":238}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"index","original":{"line":16,"column":12},"generated":{"line":1,"column":242}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"index","original":{"line":16,"column":12},"generated":{"line":1,"column":248}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":16,"column":20},"generated":{"line":1,"column":250}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":16,"column":24},"generated":{"line":1,"column":252}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"indexOf","original":{"line":16,"column":29},"generated":{"line":1,"column":257}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"matching","original":{"line":16,"column":37},"generated":{"line":1,"column":265}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":22,"column":13},"generated":{"line":1,"column":268}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":18,"column":10},"generated":{"line":1,"column":275}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":18,"column":14},"generated":{"line":1,"column":277}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":18,"column":32},"generated":{"line":1,"column":283}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"index","original":{"line":18,"column":22},"generated":{"line":1,"column":287}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":19,"column":8},"generated":{"line":1,"column":291}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":19,"column":12},"generated":{"line":1,"column":293}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":19,"column":19},"generated":{"line":1,"column":298}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":19,"column":23},"generated":{"line":1,"column":300}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"substr","original":{"line":19,"column":28},"generated":{"line":1,"column":305}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"index","original":{"line":19,"column":35},"generated":{"line":1,"column":312}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"matching","original":{"line":19,"column":43},"generated":{"line":1,"column":314}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"length","original":{"line":19,"column":52},"generated":{"line":1,"column":316}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":22,"column":13},"generated":{"line":1,"column":325}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":27,"column":0},"generated":{"line":1,"column":329}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"ListCollectionsOperation","original":{"line":27,"column":6},"generated":{"line":1,"column":335}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"CommandOperationV2","original":{"line":27,"column":39},"generated":{"line":1,"column":345}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"constructor","original":{"line":28,"column":2},"generated":{"line":1,"column":347}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":28,"column":14},"generated":{"line":1,"column":359}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":28,"column":18},"generated":{"line":1,"column":361}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"options","original":{"line":28,"column":26},"generated":{"line":1,"column":363}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":29,"column":10},"generated":{"line":1,"column":366}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":29,"column":10},"generated":{"line":1,"column":372}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"options","original":{"line":29,"column":14},"generated":{"line":1,"column":374}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":29,"column":23},"generated":{"line":1,"column":376}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"fullResponse","original":{"line":29,"column":25},"generated":{"line":1,"column":377}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":29,"column":39},"generated":{"line":1,"column":391}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":31,"column":9},"generated":{"line":1,"column":395}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":31,"column":9},"generated":{"line":1,"column":400}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":31,"column":14},"generated":{"line":1,"column":403}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":32,"column":9},"generated":{"line":1,"column":405}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":32,"column":9},"generated":{"line":1,"column":410}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":32,"column":18},"generated":{"line":1,"column":417}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"nameOnly","original":{"line":33,"column":9},"generated":{"line":1,"column":419}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"nameOnly","original":{"line":33,"column":9},"generated":{"line":1,"column":424}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":33,"column":22},"generated":{"line":1,"column":435}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"options","original":{"line":33,"column":27},"generated":{"line":1,"column":440}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"nameOnly","original":{"line":33,"column":35},"generated":{"line":1,"column":448}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":35,"column":42},"generated":{"line":1,"column":457}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":35,"column":15},"generated":{"line":1,"column":474}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"options","original":{"line":35,"column":20},"generated":{"line":1,"column":479}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":35,"column":28},"generated":{"line":1,"column":487}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":36,"column":11},"generated":{"line":1,"column":499}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":36,"column":11},"generated":{"line":1,"column":504}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":36,"column":23},"generated":{"line":1,"column":514}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"options","original":{"line":36,"column":28},"generated":{"line":1,"column":519}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":36,"column":36},"generated":{"line":1,"column":527}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"execute","original":{"line":40,"column":2},"generated":{"line":1,"column":538}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"server","original":{"line":40,"column":10},"generated":{"line":1,"column":546}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"callback","original":{"line":40,"column":18},"generated":{"line":1,"column":548}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"maxWireVersion","original":{"line":41,"column":8},"generated":{"line":1,"column":551}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"maxWireVersion","original":{"line":41,"column":8},"generated":{"line":1,"column":554}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"server","original":{"line":41,"column":23},"generated":{"line":1,"column":556}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"LIST_COLLECTIONS_WIRE_VERSION","original":{"line":41,"column":33},"generated":{"line":1,"column":559}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":41,"column":64},"generated":{"line":1,"column":561}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":42,"column":10},"generated":{"line":1,"column":562}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":42,"column":10},"generated":{"line":1,"column":566}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":42,"column":19},"generated":{"line":1,"column":568}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":42,"column":24},"generated":{"line":1,"column":573}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":43,"column":12},"generated":{"line":1,"column":580}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":43,"column":12},"generated":{"line":1,"column":586}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":43,"column":27},"generated":{"line":1,"column":588}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":43,"column":32},"generated":{"line":1,"column":593}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"s","original":{"line":43,"column":35},"generated":{"line":1,"column":596}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"namespace","original":{"line":43,"column":37},"generated":{"line":1,"column":598}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":43,"column":47},"generated":{"line":1,"column":608}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":47,"column":31},"generated":{"line":1,"column":611}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":47,"column":15},"generated":{"line":1,"column":628}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":47,"column":22},"generated":{"line":1,"column":630}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":48,"column":9},"generated":{"line":1,"column":636}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"RegExp","original":{"line":48,"column":13},"generated":{"line":1,"column":640}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":48,"column":20},"generated":{"line":1,"column":647}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":48,"column":26},"generated":{"line":1,"column":651}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":48,"column":41},"generated":{"line":1,"column":653}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"test","original":{"line":48,"column":48},"generated":{"line":1,"column":660}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":48,"column":53},"generated":{"line":1,"column":665}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":48,"column":60},"generated":{"line":1,"column":667}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":50,"column":8},"generated":{"line":1,"column":676}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"Object","original":{"line":50,"column":17},"generated":{"line":1,"column":678}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"assign","original":{"line":50,"column":24},"generated":{"line":1,"column":685}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":50,"column":31},"generated":{"line":1,"column":692}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":50,"column":35},"generated":{"line":1,"column":695}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":51,"column":15},"generated":{"line":1,"column":699}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":51,"column":22},"generated":{"line":1,"column":704}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"db","original":{"line":51,"column":27},"generated":{"line":1,"column":709}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"s","original":{"line":51,"column":30},"generated":{"line":1,"column":712}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"namespace","original":{"line":51,"column":32},"generated":{"line":1,"column":714}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"withCollection","original":{"line":51,"column":42},"generated":{"line":1,"column":724}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":51,"column":57},"generated":{"line":1,"column":739}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":51,"column":64},"generated":{"line":1,"column":741}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"toString","original":{"line":51,"column":70},"generated":{"line":1,"column":747}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":55,"column":20},"generated":{"line":1,"column":759}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":55,"column":10},"generated":{"line":1,"column":765}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":56,"column":8},"generated":{"line":1,"column":769}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":56,"column":15},"generated":{"line":1,"column":771}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":56,"column":26},"generated":{"line":1,"column":776}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":56,"column":26},"generated":{"line":1,"column":780}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":56,"column":26},"generated":{"line":1,"column":787}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":56,"column":8},"generated":{"line":1,"column":789}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":61,"column":8},"generated":{"line":1,"column":795}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":60,"column":10},"generated":{"line":1,"column":797}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":60,"column":17},"generated":{"line":1,"column":799}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":61,"column":17},"generated":{"line":1,"column":804}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"$and","original":{"line":61,"column":19},"generated":{"line":1,"column":805}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":61,"column":25},"generated":{"line":1,"column":810}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":61,"column":26},"generated":{"line":1,"column":811}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":61,"column":28},"generated":{"line":1,"column":812}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":61,"column":34},"generated":{"line":1,"column":817}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":61,"column":41},"generated":{"line":1,"column":819}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":61,"column":49},"generated":{"line":1,"column":825}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":61,"column":51},"generated":{"line":1,"column":826}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":61,"column":57},"generated":{"line":1,"column":831}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":63,"column":17},"generated":{"line":1,"column":849}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"name","original":{"line":63,"column":19},"generated":{"line":1,"column":850}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":63,"column":25},"generated":{"line":1,"column":855}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"transforms","original":{"line":66,"column":12},"generated":{"line":1,"column":871}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"transforms","original":{"line":66,"column":12},"generated":{"line":1,"column":877}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"listCollectionsTransforms","original":{"line":66,"column":25},"generated":{"line":1,"column":879}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":66,"column":51},"generated":{"line":1,"column":881}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":86,"column":6},"generated":{"line":1,"column":884}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"server","original":{"line":67,"column":6},"generated":{"line":1,"column":896}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"query","original":{"line":67,"column":13},"generated":{"line":1,"column":898}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":68,"column":11},"generated":{"line":1,"column":904}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":68,"column":11},"generated":{"line":1,"column":907}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"databaseName","original":{"line":68,"column":11},"generated":{"line":1,"column":914}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"CONSTANTS","original":{"line":68,"column":27},"generated":{"line":1,"column":916}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"CONSTANTS","original":{"line":68,"column":27},"generated":{"line":1,"column":921}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"CONSTANTS","original":{"line":68,"column":27},"generated":{"line":1,"column":928}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"SYSTEM_NAMESPACE_COLLECTION","original":{"line":68,"column":37},"generated":{"line":1,"column":930}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":69,"column":8},"generated":{"line":1,"column":959}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"query","original":{"line":69,"column":10},"generated":{"line":1,"column":960}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":69,"column":17},"generated":{"line":1,"column":966}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":70,"column":8},"generated":{"line":1,"column":969}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":70,"column":10},"generated":{"line":1,"column":970}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":70,"column":21},"generated":{"line":1,"column":980}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":70,"column":26},"generated":{"line":1,"column":985}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":70,"column":39},"generated":{"line":1,"column":996}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":71,"column":8},"generated":{"line":1,"column":1001}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":72,"column":8},"generated":{"line":1,"column":1004}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"err","original":{"line":72,"column":9},"generated":{"line":1,"column":1005}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":72,"column":14},"generated":{"line":1,"column":1007}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":74,"column":12},"generated":{"line":1,"column":1012}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":75,"column":12},"generated":{"line":1,"column":1015}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"message","original":{"line":75,"column":19},"generated":{"line":1,"column":1017}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":76,"column":12},"generated":{"line":1,"column":1026}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"message","original":{"line":76,"column":19},"generated":{"line":1,"column":1028}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"documents","original":{"line":76,"column":27},"generated":{"line":1,"column":1036}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"Array","original":{"line":77,"column":12},"generated":{"line":1,"column":1047}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"isArray","original":{"line":77,"column":18},"generated":{"line":1,"column":1053}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":77,"column":26},"generated":{"line":1,"column":1061}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"message","original":{"line":77,"column":33},"generated":{"line":1,"column":1063}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"documents","original":{"line":77,"column":41},"generated":{"line":1,"column":1071}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":79,"column":12},"generated":{"line":1,"column":1084}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"message","original":{"line":79,"column":19},"generated":{"line":1,"column":1086}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"documents","original":{"line":79,"column":27},"generated":{"line":1,"column":1094}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":79,"column":39},"generated":{"line":1,"column":1104}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"message","original":{"line":79,"column":46},"generated":{"line":1,"column":1106}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"documents","original":{"line":79,"column":54},"generated":{"line":1,"column":1114}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"map","original":{"line":79,"column":64},"generated":{"line":1,"column":1124}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"transforms","original":{"line":79,"column":68},"generated":{"line":1,"column":1128}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"doc","original":{"line":79,"column":79},"generated":{"line":1,"column":1130}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"callback","original":{"line":82,"column":10},"generated":{"line":1,"column":1136}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"err","original":{"line":82,"column":19},"generated":{"line":1,"column":1138}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"result","original":{"line":82,"column":24},"generated":{"line":1,"column":1140}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"command","original":{"line":89,"column":10},"generated":{"line":1,"column":1145}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"command","original":{"line":89,"column":10},"generated":{"line":1,"column":1151}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":89,"column":20},"generated":{"line":1,"column":1153}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"listCollections","original":{"line":90,"column":6},"generated":{"line":1,"column":1154}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":90,"column":23},"generated":{"line":1,"column":1170}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":91,"column":6},"generated":{"line":1,"column":1172}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":91,"column":14},"generated":{"line":1,"column":1179}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"filter","original":{"line":91,"column":19},"generated":{"line":1,"column":1184}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"cursor","original":{"line":92,"column":6},"generated":{"line":1,"column":1191}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":92,"column":14},"generated":{"line":1,"column":1198}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":92,"column":19},"generated":{"line":1,"column":1203}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":92,"column":31},"generated":{"line":1,"column":1213}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":92,"column":33},"generated":{"line":1,"column":1214}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":92,"column":44},"generated":{"line":1,"column":1224}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"batchSize","original":{"line":92,"column":49},"generated":{"line":1,"column":1229}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":92,"column":63},"generated":{"line":1,"column":1240}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"nameOnly","original":{"line":93,"column":6},"generated":{"line":1,"column":1243}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":93,"column":16},"generated":{"line":1,"column":1252}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"nameOnly","original":{"line":93,"column":21},"generated":{"line":1,"column":1257}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":96,"column":11},"generated":{"line":1,"column":1267}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":96,"column":11},"generated":{"line":1,"column":1274}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"executeCommand","original":{"line":96,"column":17},"generated":{"line":1,"column":1280}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"server","original":{"line":96,"column":32},"generated":{"line":1,"column":1295}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"command","original":{"line":96,"column":40},"generated":{"line":1,"column":1297}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"callback","original":{"line":96,"column":49},"generated":{"line":1,"column":1299}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"defineAspects","original":{"line":100,"column":0},"generated":{"line":1,"column":1303}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"ListCollectionsOperation","original":{"line":100,"column":14},"generated":{"line":1,"column":1305}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","original":{"line":100,"column":40},"generated":{"line":1,"column":1307}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"Aspect","original":{"line":101,"column":2},"generated":{"line":1,"column":1308}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"READ_OPERATION","original":{"line":101,"column":9},"generated":{"line":1,"column":1310}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"Aspect","original":{"line":102,"column":2},"generated":{"line":1,"column":1325}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"RETRYABLE","original":{"line":102,"column":9},"generated":{"line":1,"column":1327}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"Aspect","original":{"line":103,"column":2},"generated":{"line":1,"column":1337}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"EXECUTE_WITH_SELECTION","original":{"line":103,"column":9},"generated":{"line":1,"column":1339}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"module","original":{"line":106,"column":0},"generated":{"line":1,"column":1364}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"exports","original":{"line":106,"column":7},"generated":{"line":1,"column":1371}},{"source":"../node_modules/mongodb/lib/operations/list_collections.js","name":"ListCollectionsOperation","original":{"line":106,"column":17},"generated":{"line":1,"column":1379}}],"sources":{"../node_modules/mongodb/lib/operations/list_collections.js":"'use strict';\n\nconst CommandOperationV2 = require('./command_v2');\nconst Aspect = require('./operation').Aspect;\nconst defineAspects = require('./operation').defineAspects;\nconst maxWireVersion = require('../core/utils').maxWireVersion;\nconst CONSTANTS = require('../constants');\n\nconst LIST_COLLECTIONS_WIRE_VERSION = 3;\n\nfunction listCollectionsTransforms(databaseName) {\n  const matching = `${databaseName}.`;\n\n  return {\n    doc: doc => {\n      const index = doc.name.indexOf(matching);\n      // Remove database name if available\n      if (doc.name && index === 0) {\n        doc.name = doc.name.substr(index + matching.length);\n      }\n\n      return doc;\n    }\n  };\n}\n\nclass ListCollectionsOperation extends CommandOperationV2 {\n  constructor(db, filter, options) {\n    super(db, options, { fullResponse: true });\n\n    this.db = db;\n    this.filter = filter;\n    this.nameOnly = !!this.options.nameOnly;\n\n    if (typeof this.options.batchSize === 'number') {\n      this.batchSize = this.options.batchSize;\n    }\n  }\n\n  execute(server, callback) {\n    if (maxWireVersion(server) < LIST_COLLECTIONS_WIRE_VERSION) {\n      let filter = this.filter;\n      const databaseName = this.db.s.namespace.db;\n\n      // If we have legacy mode and have not provided a full db name filter it\n      if (\n        typeof filter.name === 'string' &&\n        !new RegExp('^' + databaseName + '\\\\.').test(filter.name)\n      ) {\n        filter = Object.assign({}, filter);\n        filter.name = this.db.s.namespace.withCollection(filter.name).toString();\n      }\n\n      // No filter, filter by current database\n      if (filter == null) {\n        filter.name = `/${databaseName}/`;\n      }\n\n      // Rewrite the filter to use $and to filter out indexes\n      if (filter.name) {\n        filter = { $and: [{ name: filter.name }, { name: /^((?!\\$).)*$/ }] };\n      } else {\n        filter = { name: /^((?!\\$).)*$/ };\n      }\n\n      const transforms = listCollectionsTransforms(databaseName);\n      server.query(\n        `${databaseName}.${CONSTANTS.SYSTEM_NAMESPACE_COLLECTION}`,\n        { query: filter },\n        { batchSize: this.batchSize || 1000 },\n        {},\n        (err, result) => {\n          if (\n            result &&\n            result.message &&\n            result.message.documents &&\n            Array.isArray(result.message.documents)\n          ) {\n            result.message.documents = result.message.documents.map(transforms.doc);\n          }\n\n          callback(err, result);\n        }\n      );\n\n      return;\n    }\n\n    const command = {\n      listCollections: 1,\n      filter: this.filter,\n      cursor: this.batchSize ? { batchSize: this.batchSize } : {},\n      nameOnly: this.nameOnly\n    };\n\n    return super.executeCommand(server, command, callback);\n  }\n}\n\ndefineAspects(ListCollectionsOperation, [\n  Aspect.READ_OPERATION,\n  Aspect.RETRYABLE,\n  Aspect.EXECUTE_WITH_SELECTION\n]);\n\nmodule.exports = ListCollectionsOperation;\n"},"lineCount":null}},"error":null,"hash":"01bf8cdd15cd2a4139ee6d079fefafa7","cacheData":{"env":{}}}