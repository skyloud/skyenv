{"id":"wIta","dependencies":[{"name":"/Users/etienne/skyenv/package.json","includedInParent":true,"mtime":1596478551490},{"name":"/Users/etienne/skyenv/node_modules/mongodb/package.json","includedInParent":true,"mtime":1596467161400},{"name":"./error","loc":{"line":2,"column":27},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/transactions.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/error.js"},{"name":"./topologies/read_preference","loc":{"line":3,"column":31},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/transactions.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/topologies/read_preference.js"},{"name":"../read_concern","loc":{"line":4,"column":28},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/transactions.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/read_concern.js"},{"name":"../write_concern","loc":{"line":5,"column":29},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/transactions.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/write_concern.js"}],"generated":{"js":"\"use strict\";function T(T,e,N){return e in T?Object.defineProperty(T,e,{value:N,enumerable:!0,configurable:!0,writable:!0}):T[e]=N,T}const e=require(\"./error\").MongoError,N=require(\"./topologies/read_preference\"),t=require(\"../read_concern\"),r=require(\"../write_concern\");let A,n;(()=>{var e;A={NO_TRANSACTION:\"NO_TRANSACTION\",STARTING_TRANSACTION:\"STARTING_TRANSACTION\",TRANSACTION_IN_PROGRESS:\"TRANSACTION_IN_PROGRESS\",TRANSACTION_COMMITTED:\"TRANSACTION_COMMITTED\",TRANSACTION_COMMITTED_EMPTY:\"TRANSACTION_COMMITTED_EMPTY\",TRANSACTION_ABORTED:\"TRANSACTION_ABORTED\"},T(e={},\"NO_TRANSACTION\",[\"NO_TRANSACTION\",\"STARTING_TRANSACTION\"]),T(e,\"STARTING_TRANSACTION\",[\"TRANSACTION_IN_PROGRESS\",\"TRANSACTION_COMMITTED\",\"TRANSACTION_COMMITTED_EMPTY\",\"TRANSACTION_ABORTED\"]),T(e,\"TRANSACTION_IN_PROGRESS\",[\"TRANSACTION_IN_PROGRESS\",\"TRANSACTION_COMMITTED\",\"TRANSACTION_ABORTED\"]),T(e,\"TRANSACTION_COMMITTED\",[\"TRANSACTION_COMMITTED\",\"TRANSACTION_COMMITTED_EMPTY\",\"STARTING_TRANSACTION\",\"NO_TRANSACTION\"]),T(e,\"TRANSACTION_ABORTED\",[\"STARTING_TRANSACTION\",\"NO_TRANSACTION\"]),T(e,\"TRANSACTION_COMMITTED_EMPTY\",[\"TRANSACTION_COMMITTED_EMPTY\",\"NO_TRANSACTION\"]),n=e})();class i{constructor(T){T=T||{},this.state=A.NO_TRANSACTION,this.options={};const n=r.fromOptions(T);if(n){if(n.w<=0)throw new e(\"Transactions do not support unacknowledged write concern\");this.options.writeConcern=n}T.readConcern&&(this.options.readConcern=t.fromOptions(T)),T.readPreference&&(this.options.readPreference=N.fromOptions(T)),T.maxCommitTimeMS&&(this.options.maxTimeMS=T.maxCommitTimeMS),this._pinnedServer=void 0,this._recoveryToken=void 0}get server(){return this._pinnedServer}get recoveryToken(){return this._recoveryToken}get isPinned(){return!!this.server}get isActive(){return-1!==[A.STARTING_TRANSACTION,A.TRANSACTION_IN_PROGRESS].indexOf(this.state)}transition(T){const N=n[this.state];if(N&&-1!==N.indexOf(T))return this.state=T,void(this.state!==A.NO_TRANSACTION&&this.state!==A.STARTING_TRANSACTION||this.unpinServer());throw new e(\"Attempted illegal state transition from [\".concat(this.state,\"] to [\").concat(T,\"]\"))}pinServer(T){this.isActive&&(this._pinnedServer=T)}unpinServer(){this._pinnedServer=void 0}}function O(T){return!(!T.commitTransaction&&!T.abortTransaction)}module.exports={TxnState:A,Transaction:i,isTransactionCommand:O};"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":13}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":22}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":24}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":26}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":28}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":31}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":38}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":43}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":45}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":52}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":67}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":69}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":71}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":72}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":78}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":80}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":92}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":94}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":108}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":110}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":120}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":124}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":126}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":129}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":0},"generated":{"line":1,"column":131}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":2,"column":0},"generated":{"line":1,"column":133}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"MongoError","original":{"line":2,"column":6},"generated":{"line":1,"column":139}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"require","original":{"line":2,"column":19},"generated":{"line":1,"column":141}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":2,"column":27},"generated":{"line":1,"column":149}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"MongoError","original":{"line":2,"column":38},"generated":{"line":1,"column":160}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"ReadPreference","original":{"line":3,"column":6},"generated":{"line":1,"column":171}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"require","original":{"line":3,"column":23},"generated":{"line":1,"column":173}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":3,"column":31},"generated":{"line":1,"column":181}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"ReadConcern","original":{"line":4,"column":6},"generated":{"line":1,"column":213}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"require","original":{"line":4,"column":20},"generated":{"line":1,"column":215}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":4,"column":28},"generated":{"line":1,"column":223}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"WriteConcern","original":{"line":5,"column":6},"generated":{"line":1,"column":242}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"require","original":{"line":5,"column":21},"generated":{"line":1,"column":244}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":5,"column":29},"generated":{"line":1,"column":252}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":7,"column":0},"generated":{"line":1,"column":272}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":7,"column":4},"generated":{"line":1,"column":276}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"stateMachine","original":{"line":8,"column":4},"generated":{"line":1,"column":278}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":10,"column":0},"generated":{"line":1,"column":280}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":10,"column":7},"generated":{"line":1,"column":286}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":10,"column":7},"generated":{"line":1,"column":290}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":18,"column":2},"generated":{"line":1,"column":292}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":18,"column":13},"generated":{"line":1,"column":294}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"NO_TRANSACTION","original":{"line":19,"column":4},"generated":{"line":1,"column":295}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":11,"column":25},"generated":{"line":1,"column":310}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"STARTING_TRANSACTION","original":{"line":20,"column":4},"generated":{"line":1,"column":327}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":12,"column":31},"generated":{"line":1,"column":348}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_IN_PROGRESS","original":{"line":21,"column":4},"generated":{"line":1,"column":371}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":13,"column":34},"generated":{"line":1,"column":395}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_COMMITTED","original":{"line":22,"column":4},"generated":{"line":1,"column":421}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":14,"column":32},"generated":{"line":1,"column":443}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_COMMITTED_EMPTY","original":{"line":23,"column":4},"generated":{"line":1,"column":467}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":15,"column":38},"generated":{"line":1,"column":495}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_ABORTED","original":{"line":24,"column":4},"generated":{"line":1,"column":525}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":16,"column":30},"generated":{"line":1,"column":545}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"NO_TRANSACTION","original":{"line":28,"column":5},"generated":{"line":1,"column":568}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"NO_TRANSACTION","original":{"line":28,"column":5},"generated":{"line":1,"column":570}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"NO_TRANSACTION","original":{"line":28,"column":5},"generated":{"line":1,"column":572}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":11,"column":25},"generated":{"line":1,"column":575}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":28,"column":22},"generated":{"line":1,"column":592}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":11,"column":25},"generated":{"line":1,"column":593}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":12,"column":31},"generated":{"line":1,"column":610}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"STARTING_TRANSACTION","original":{"line":29,"column":5},"generated":{"line":1,"column":635}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"STARTING_TRANSACTION","original":{"line":29,"column":5},"generated":{"line":1,"column":637}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":12,"column":31},"generated":{"line":1,"column":639}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":29,"column":28},"generated":{"line":1,"column":662}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":13,"column":34},"generated":{"line":1,"column":663}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":14,"column":32},"generated":{"line":1,"column":689}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":15,"column":38},"generated":{"line":1,"column":713}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":16,"column":30},"generated":{"line":1,"column":743}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_IN_PROGRESS","original":{"line":35,"column":5},"generated":{"line":1,"column":767}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_IN_PROGRESS","original":{"line":35,"column":5},"generated":{"line":1,"column":769}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":13,"column":34},"generated":{"line":1,"column":771}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":35,"column":31},"generated":{"line":1,"column":797}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":13,"column":34},"generated":{"line":1,"column":798}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":14,"column":32},"generated":{"line":1,"column":824}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":16,"column":30},"generated":{"line":1,"column":848}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_COMMITTED","original":{"line":40,"column":5},"generated":{"line":1,"column":872}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_COMMITTED","original":{"line":40,"column":5},"generated":{"line":1,"column":874}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":14,"column":32},"generated":{"line":1,"column":876}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":40,"column":29},"generated":{"line":1,"column":900}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":14,"column":32},"generated":{"line":1,"column":901}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":15,"column":38},"generated":{"line":1,"column":925}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":12,"column":31},"generated":{"line":1,"column":955}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":11,"column":25},"generated":{"line":1,"column":978}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_ABORTED","original":{"line":46,"column":5},"generated":{"line":1,"column":997}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_ABORTED","original":{"line":46,"column":5},"generated":{"line":1,"column":999}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":16,"column":30},"generated":{"line":1,"column":1001}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":46,"column":27},"generated":{"line":1,"column":1023}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":12,"column":31},"generated":{"line":1,"column":1024}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":11,"column":25},"generated":{"line":1,"column":1047}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_COMMITTED_EMPTY","original":{"line":47,"column":5},"generated":{"line":1,"column":1066}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_COMMITTED_EMPTY","original":{"line":47,"column":5},"generated":{"line":1,"column":1068}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":15,"column":38},"generated":{"line":1,"column":1070}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":47,"column":35},"generated":{"line":1,"column":1100}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":15,"column":38},"generated":{"line":1,"column":1101}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":11,"column":25},"generated":{"line":1,"column":1131}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"stateMachine","original":{"line":27,"column":2},"generated":{"line":1,"column":1150}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":27,"column":2},"generated":{"line":1,"column":1152}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":10,"column":0},"generated":{"line":1,"column":1155}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":83,"column":0},"generated":{"line":1,"column":1158}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"Transaction","original":{"line":83,"column":6},"generated":{"line":1,"column":1164}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"constructor","original":{"line":90,"column":2},"generated":{"line":1,"column":1166}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":90,"column":14},"generated":{"line":1,"column":1178}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":91,"column":4},"generated":{"line":1,"column":1181}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":91,"column":14},"generated":{"line":1,"column":1183}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":91,"column":25},"generated":{"line":1,"column":1186}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":93,"column":9},"generated":{"line":1,"column":1189}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":93,"column":9},"generated":{"line":1,"column":1194}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":93,"column":17},"generated":{"line":1,"column":1200}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"NO_TRANSACTION","original":{"line":93,"column":26},"generated":{"line":1,"column":1202}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":94,"column":9},"generated":{"line":1,"column":1217}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":94,"column":9},"generated":{"line":1,"column":1222}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":94,"column":19},"generated":{"line":1,"column":1230}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":96,"column":10},"generated":{"line":1,"column":1233}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":96,"column":10},"generated":{"line":1,"column":1239}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"WriteConcern","original":{"line":96,"column":25},"generated":{"line":1,"column":1241}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"fromOptions","original":{"line":96,"column":38},"generated":{"line":1,"column":1243}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":96,"column":50},"generated":{"line":1,"column":1255}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":97,"column":8},"generated":{"line":1,"column":1258}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":97,"column":8},"generated":{"line":1,"column":1261}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":97,"column":22},"generated":{"line":1,"column":1263}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":98,"column":10},"generated":{"line":1,"column":1264}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":98,"column":10},"generated":{"line":1,"column":1267}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"w","original":{"line":98,"column":23},"generated":{"line":1,"column":1269}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":98,"column":28},"generated":{"line":1,"column":1272}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":99,"column":14},"generated":{"line":1,"column":1274}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":99,"column":14},"generated":{"line":1,"column":1280}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"MongoError","original":{"line":99,"column":18},"generated":{"line":1,"column":1284}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":99,"column":29},"generated":{"line":1,"column":1286}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":102,"column":11},"generated":{"line":1,"column":1346}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":102,"column":11},"generated":{"line":1,"column":1351}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":102,"column":19},"generated":{"line":1,"column":1359}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"writeConcern","original":{"line":102,"column":34},"generated":{"line":1,"column":1372}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":105,"column":8},"generated":{"line":1,"column":1374}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"readConcern","original":{"line":105,"column":16},"generated":{"line":1,"column":1376}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":106,"column":11},"generated":{"line":1,"column":1390}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":106,"column":11},"generated":{"line":1,"column":1395}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"readConcern","original":{"line":106,"column":19},"generated":{"line":1,"column":1403}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"ReadConcern","original":{"line":106,"column":33},"generated":{"line":1,"column":1415}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"fromOptions","original":{"line":106,"column":45},"generated":{"line":1,"column":1417}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":106,"column":57},"generated":{"line":1,"column":1429}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":109,"column":8},"generated":{"line":1,"column":1433}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"readPreference","original":{"line":109,"column":16},"generated":{"line":1,"column":1435}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":110,"column":11},"generated":{"line":1,"column":1452}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":110,"column":11},"generated":{"line":1,"column":1457}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"readPreference","original":{"line":110,"column":19},"generated":{"line":1,"column":1465}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"ReadPreference","original":{"line":110,"column":36},"generated":{"line":1,"column":1480}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"fromOptions","original":{"line":110,"column":51},"generated":{"line":1,"column":1482}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":110,"column":63},"generated":{"line":1,"column":1494}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":113,"column":8},"generated":{"line":1,"column":1498}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"maxCommitTimeMS","original":{"line":113,"column":16},"generated":{"line":1,"column":1500}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":114,"column":11},"generated":{"line":1,"column":1518}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":114,"column":11},"generated":{"line":1,"column":1523}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"maxTimeMS","original":{"line":114,"column":19},"generated":{"line":1,"column":1531}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"options","original":{"line":114,"column":31},"generated":{"line":1,"column":1541}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"maxCommitTimeMS","original":{"line":114,"column":39},"generated":{"line":1,"column":1543}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_pinnedServer","original":{"line":118,"column":9},"generated":{"line":1,"column":1560}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_pinnedServer","original":{"line":118,"column":9},"generated":{"line":1,"column":1565}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"undefined","original":{"line":118,"column":25},"generated":{"line":1,"column":1584}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_recoveryToken","original":{"line":119,"column":9},"generated":{"line":1,"column":1586}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_recoveryToken","original":{"line":119,"column":9},"generated":{"line":1,"column":1591}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"undefined","original":{"line":119,"column":26},"generated":{"line":1,"column":1611}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"server","original":{"line":122,"column":6},"generated":{"line":1,"column":1613}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":123,"column":11},"generated":{"line":1,"column":1626}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":123,"column":11},"generated":{"line":1,"column":1633}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_pinnedServer","original":{"line":123,"column":16},"generated":{"line":1,"column":1638}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"recoveryToken","original":{"line":126,"column":6},"generated":{"line":1,"column":1652}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":127,"column":11},"generated":{"line":1,"column":1672}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":127,"column":11},"generated":{"line":1,"column":1679}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_recoveryToken","original":{"line":127,"column":16},"generated":{"line":1,"column":1684}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"isPinned","original":{"line":130,"column":6},"generated":{"line":1,"column":1699}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":131,"column":11},"generated":{"line":1,"column":1714}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":131,"column":13},"generated":{"line":1,"column":1722}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"server","original":{"line":131,"column":18},"generated":{"line":1,"column":1727}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"isActive","original":{"line":138,"column":6},"generated":{"line":1,"column":1734}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":140,"column":6},"generated":{"line":1,"column":1749}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":140,"column":97},"generated":{"line":1,"column":1756}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":140,"column":6},"generated":{"line":1,"column":1760}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":140,"column":7},"generated":{"line":1,"column":1761}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"STARTING_TRANSACTION","original":{"line":140,"column":16},"generated":{"line":1,"column":1763}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":140,"column":38},"generated":{"line":1,"column":1784}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TRANSACTION_IN_PROGRESS","original":{"line":140,"column":47},"generated":{"line":1,"column":1786}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"indexOf","original":{"line":140,"column":72},"generated":{"line":1,"column":1811}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":140,"column":80},"generated":{"line":1,"column":1819}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":140,"column":85},"generated":{"line":1,"column":1824}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"transition","original":{"line":149,"column":2},"generated":{"line":1,"column":1831}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextState","original":{"line":149,"column":13},"generated":{"line":1,"column":1842}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextStates","original":{"line":150,"column":10},"generated":{"line":1,"column":1845}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextStates","original":{"line":150,"column":10},"generated":{"line":1,"column":1851}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"stateMachine","original":{"line":150,"column":23},"generated":{"line":1,"column":1853}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":150,"column":36},"generated":{"line":1,"column":1855}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":150,"column":41},"generated":{"line":1,"column":1860}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextStates","original":{"line":151,"column":8},"generated":{"line":1,"column":1867}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextStates","original":{"line":151,"column":8},"generated":{"line":1,"column":1870}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":151,"column":57},"generated":{"line":1,"column":1874}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextStates","original":{"line":151,"column":22},"generated":{"line":1,"column":1878}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"indexOf","original":{"line":151,"column":33},"generated":{"line":1,"column":1880}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextState","original":{"line":151,"column":41},"generated":{"line":1,"column":1888}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":156,"column":6},"generated":{"line":1,"column":1891}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":152,"column":11},"generated":{"line":1,"column":1898}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":152,"column":11},"generated":{"line":1,"column":1903}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextState","original":{"line":152,"column":19},"generated":{"line":1,"column":1909}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":153,"column":10},"generated":{"line":1,"column":1916}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":153,"column":15},"generated":{"line":1,"column":1921}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":153,"column":25},"generated":{"line":1,"column":1929}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"NO_TRANSACTION","original":{"line":153,"column":34},"generated":{"line":1,"column":1931}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":153,"column":52},"generated":{"line":1,"column":1947}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":153,"column":57},"generated":{"line":1,"column":1952}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":153,"column":67},"generated":{"line":1,"column":1960}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"STARTING_TRANSACTION","original":{"line":153,"column":76},"generated":{"line":1,"column":1962}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"unpinServer","original":{"line":154,"column":13},"generated":{"line":1,"column":1984}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"unpinServer","original":{"line":154,"column":13},"generated":{"line":1,"column":1989}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":159,"column":10},"generated":{"line":1,"column":2004}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":159,"column":10},"generated":{"line":1,"column":2010}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"MongoError","original":{"line":159,"column":14},"generated":{"line":1,"column":2014}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":160,"column":50},"generated":{"line":1,"column":2016}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":160,"column":50},"generated":{"line":1,"column":2060}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":160,"column":50},"generated":{"line":1,"column":2067}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"state","original":{"line":160,"column":55},"generated":{"line":1,"column":2072}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextState","original":{"line":160,"column":69},"generated":{"line":1,"column":2078}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextState","original":{"line":160,"column":69},"generated":{"line":1,"column":2088}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"nextState","original":{"line":160,"column":69},"generated":{"line":1,"column":2095}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":159,"column":4},"generated":{"line":1,"column":2097}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"pinServer","original":{"line":164,"column":2},"generated":{"line":1,"column":2103}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"server","original":{"line":164,"column":12},"generated":{"line":1,"column":2113}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":165,"column":8},"generated":{"line":1,"column":2116}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"isActive","original":{"line":165,"column":13},"generated":{"line":1,"column":2121}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_pinnedServer","original":{"line":166,"column":11},"generated":{"line":1,"column":2132}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_pinnedServer","original":{"line":166,"column":11},"generated":{"line":1,"column":2137}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"server","original":{"line":166,"column":27},"generated":{"line":1,"column":2151}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"unpinServer","original":{"line":170,"column":2},"generated":{"line":1,"column":2154}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_pinnedServer","original":{"line":171,"column":9},"generated":{"line":1,"column":2168}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"_pinnedServer","original":{"line":171,"column":9},"generated":{"line":1,"column":2173}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"undefined","original":{"line":171,"column":25},"generated":{"line":1,"column":2192}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":175,"column":0},"generated":{"line":1,"column":2195}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"isTransactionCommand","original":{"line":175,"column":9},"generated":{"line":1,"column":2204}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"command","original":{"line":175,"column":30},"generated":{"line":1,"column":2206}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":176,"column":9},"generated":{"line":1,"column":2209}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"command","original":{"line":176,"column":12},"generated":{"line":1,"column":2218}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"commitTransaction","original":{"line":176,"column":20},"generated":{"line":1,"column":2220}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"command","original":{"line":176,"column":41},"generated":{"line":1,"column":2240}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"abortTransaction","original":{"line":176,"column":49},"generated":{"line":1,"column":2242}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"module","original":{"line":179,"column":0},"generated":{"line":1,"column":2260}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"exports","original":{"line":179,"column":7},"generated":{"line":1,"column":2267}},{"source":"../node_modules/mongodb/lib/core/transactions.js","original":{"line":179,"column":17},"generated":{"line":1,"column":2275}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":179,"column":19},"generated":{"line":1,"column":2276}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"TxnState","original":{"line":179,"column":19},"generated":{"line":1,"column":2285}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"Transaction","original":{"line":179,"column":29},"generated":{"line":1,"column":2287}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"Transaction","original":{"line":179,"column":29},"generated":{"line":1,"column":2299}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"isTransactionCommand","original":{"line":179,"column":42},"generated":{"line":1,"column":2301}},{"source":"../node_modules/mongodb/lib/core/transactions.js","name":"isTransactionCommand","original":{"line":179,"column":42},"generated":{"line":1,"column":2322}}],"sources":{"../node_modules/mongodb/lib/core/transactions.js":"'use strict';\nconst MongoError = require('./error').MongoError;\nconst ReadPreference = require('./topologies/read_preference');\nconst ReadConcern = require('../read_concern');\nconst WriteConcern = require('../write_concern');\n\nlet TxnState;\nlet stateMachine;\n\n(() => {\n  const NO_TRANSACTION = 'NO_TRANSACTION';\n  const STARTING_TRANSACTION = 'STARTING_TRANSACTION';\n  const TRANSACTION_IN_PROGRESS = 'TRANSACTION_IN_PROGRESS';\n  const TRANSACTION_COMMITTED = 'TRANSACTION_COMMITTED';\n  const TRANSACTION_COMMITTED_EMPTY = 'TRANSACTION_COMMITTED_EMPTY';\n  const TRANSACTION_ABORTED = 'TRANSACTION_ABORTED';\n\n  TxnState = {\n    NO_TRANSACTION,\n    STARTING_TRANSACTION,\n    TRANSACTION_IN_PROGRESS,\n    TRANSACTION_COMMITTED,\n    TRANSACTION_COMMITTED_EMPTY,\n    TRANSACTION_ABORTED\n  };\n\n  stateMachine = {\n    [NO_TRANSACTION]: [NO_TRANSACTION, STARTING_TRANSACTION],\n    [STARTING_TRANSACTION]: [\n      TRANSACTION_IN_PROGRESS,\n      TRANSACTION_COMMITTED,\n      TRANSACTION_COMMITTED_EMPTY,\n      TRANSACTION_ABORTED\n    ],\n    [TRANSACTION_IN_PROGRESS]: [\n      TRANSACTION_IN_PROGRESS,\n      TRANSACTION_COMMITTED,\n      TRANSACTION_ABORTED\n    ],\n    [TRANSACTION_COMMITTED]: [\n      TRANSACTION_COMMITTED,\n      TRANSACTION_COMMITTED_EMPTY,\n      STARTING_TRANSACTION,\n      NO_TRANSACTION\n    ],\n    [TRANSACTION_ABORTED]: [STARTING_TRANSACTION, NO_TRANSACTION],\n    [TRANSACTION_COMMITTED_EMPTY]: [TRANSACTION_COMMITTED_EMPTY, NO_TRANSACTION]\n  };\n})();\n\n/**\n * The MongoDB ReadConcern, which allows for control of the consistency and isolation properties\n * of the data read from replica sets and replica set shards.\n * @typedef {Object} ReadConcern\n * @property {'local'|'available'|'majority'|'linearizable'|'snapshot'} level The readConcern Level\n * @see https://docs.mongodb.com/manual/reference/read-concern/\n */\n\n/**\n * A MongoDB WriteConcern, which describes the level of acknowledgement\n * requested from MongoDB for write operations.\n * @typedef {Object} WriteConcern\n * @property {number|'majority'|string} [w=1] requests acknowledgement that the write operation has\n * propagated to a specified number of mongod hosts\n * @property {boolean} [j=false] requests acknowledgement from MongoDB that the write operation has\n * been written to the journal\n * @property {number} [wtimeout] a time limit, in milliseconds, for the write concern\n * @see https://docs.mongodb.com/manual/reference/write-concern/\n */\n\n/**\n * Configuration options for a transaction.\n * @typedef {Object} TransactionOptions\n * @property {ReadConcern} [readConcern] A default read concern for commands in this transaction\n * @property {WriteConcern} [writeConcern] A default writeConcern for commands in this transaction\n * @property {ReadPreference} [readPreference] A default read preference for commands in this transaction\n */\n\n/**\n * A class maintaining state related to a server transaction. Internal Only\n * @ignore\n */\nclass Transaction {\n  /**\n   * Create a transaction\n   *\n   * @ignore\n   * @param {TransactionOptions} [options] Optional settings\n   */\n  constructor(options) {\n    options = options || {};\n\n    this.state = TxnState.NO_TRANSACTION;\n    this.options = {};\n\n    const writeConcern = WriteConcern.fromOptions(options);\n    if (writeConcern) {\n      if (writeConcern.w <= 0) {\n        throw new MongoError('Transactions do not support unacknowledged write concern');\n      }\n\n      this.options.writeConcern = writeConcern;\n    }\n\n    if (options.readConcern) {\n      this.options.readConcern = ReadConcern.fromOptions(options);\n    }\n\n    if (options.readPreference) {\n      this.options.readPreference = ReadPreference.fromOptions(options);\n    }\n\n    if (options.maxCommitTimeMS) {\n      this.options.maxTimeMS = options.maxCommitTimeMS;\n    }\n\n    // TODO: This isn't technically necessary\n    this._pinnedServer = undefined;\n    this._recoveryToken = undefined;\n  }\n\n  get server() {\n    return this._pinnedServer;\n  }\n\n  get recoveryToken() {\n    return this._recoveryToken;\n  }\n\n  get isPinned() {\n    return !!this.server;\n  }\n\n  /**\n   * @ignore\n   * @return Whether this session is presently in a transaction\n   */\n  get isActive() {\n    return (\n      [TxnState.STARTING_TRANSACTION, TxnState.TRANSACTION_IN_PROGRESS].indexOf(this.state) !== -1\n    );\n  }\n\n  /**\n   * Transition the transaction in the state machine\n   * @ignore\n   * @param {TxnState} state The new state to transition to\n   */\n  transition(nextState) {\n    const nextStates = stateMachine[this.state];\n    if (nextStates && nextStates.indexOf(nextState) !== -1) {\n      this.state = nextState;\n      if (this.state === TxnState.NO_TRANSACTION || this.state === TxnState.STARTING_TRANSACTION) {\n        this.unpinServer();\n      }\n      return;\n    }\n\n    throw new MongoError(\n      `Attempted illegal state transition from [${this.state}] to [${nextState}]`\n    );\n  }\n\n  pinServer(server) {\n    if (this.isActive) {\n      this._pinnedServer = server;\n    }\n  }\n\n  unpinServer() {\n    this._pinnedServer = undefined;\n  }\n}\n\nfunction isTransactionCommand(command) {\n  return !!(command.commitTransaction || command.abortTransaction);\n}\n\nmodule.exports = { TxnState, Transaction, isTransactionCommand };\n"},"lineCount":null}},"error":null,"hash":"aa78265b8c0373b9820c5d58ae9b96e2","cacheData":{"env":{}}}