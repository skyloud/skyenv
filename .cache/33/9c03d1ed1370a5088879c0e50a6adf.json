{"id":"o170","dependencies":[{"name":"/Users/etienne/skyenv/package.json","includedInParent":true,"mtime":1596478551490},{"name":"/Users/etienne/skyenv/node_modules/mongodb/package.json","includedInParent":true,"mtime":1596467161400},{"name":"./aggregate","loc":{"line":3,"column":35},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/count_documents.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/aggregate.js"}],"generated":{"js":"\"use strict\";const t=require(\"./aggregate\");class s extends t{constructor(t,s,u){const e=[{$match:s}];\"number\"==typeof u.skip&&e.push({$skip:u.skip}),\"number\"==typeof u.limit&&e.push({$limit:u.limit}),e.push({$group:{_id:1,n:{$sum:1}}}),super(t,e,u)}execute(t,s){super.execute(t,(t,u)=>{if(t)return void s(t,null);const e=u.result;if(null==e.cursor||null==e.cursor.firstBatch)return void s(null,0);const r=e.cursor.firstBatch;s(null,r.length?r[0].n:0)})}}module.exports=s;"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":3,"column":0},"generated":{"line":1,"column":13}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"AggregateOperation","original":{"line":3,"column":6},"generated":{"line":1,"column":19}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"require","original":{"line":3,"column":27},"generated":{"line":1,"column":21}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":3,"column":35},"generated":{"line":1,"column":29}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":5,"column":0},"generated":{"line":1,"column":44}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"CountDocumentsOperation","original":{"line":5,"column":6},"generated":{"line":1,"column":50}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"AggregateOperation","original":{"line":5,"column":38},"generated":{"line":1,"column":60}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"constructor","original":{"line":6,"column":2},"generated":{"line":1,"column":62}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"collection","original":{"line":6,"column":14},"generated":{"line":1,"column":74}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"query","original":{"line":6,"column":26},"generated":{"line":1,"column":76}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"options","original":{"line":6,"column":33},"generated":{"line":1,"column":78}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"pipeline","original":{"line":7,"column":10},"generated":{"line":1,"column":81}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"pipeline","original":{"line":7,"column":10},"generated":{"line":1,"column":87}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":7,"column":21},"generated":{"line":1,"column":89}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":7,"column":22},"generated":{"line":1,"column":90}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"$match","original":{"line":7,"column":24},"generated":{"line":1,"column":91}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"query","original":{"line":7,"column":32},"generated":{"line":1,"column":98}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":8,"column":32},"generated":{"line":1,"column":102}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"options","original":{"line":8,"column":15},"generated":{"line":1,"column":119}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"skip","original":{"line":8,"column":23},"generated":{"line":1,"column":121}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"pipeline","original":{"line":9,"column":6},"generated":{"line":1,"column":127}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"push","original":{"line":9,"column":15},"generated":{"line":1,"column":129}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":9,"column":20},"generated":{"line":1,"column":134}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"$skip","original":{"line":9,"column":22},"generated":{"line":1,"column":135}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"options","original":{"line":9,"column":29},"generated":{"line":1,"column":141}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"skip","original":{"line":9,"column":37},"generated":{"line":1,"column":143}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":12,"column":33},"generated":{"line":1,"column":150}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"options","original":{"line":12,"column":15},"generated":{"line":1,"column":167}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"limit","original":{"line":12,"column":23},"generated":{"line":1,"column":169}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"pipeline","original":{"line":13,"column":6},"generated":{"line":1,"column":176}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"push","original":{"line":13,"column":15},"generated":{"line":1,"column":178}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":13,"column":20},"generated":{"line":1,"column":183}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"$limit","original":{"line":13,"column":22},"generated":{"line":1,"column":184}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"options","original":{"line":13,"column":30},"generated":{"line":1,"column":191}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"limit","original":{"line":13,"column":38},"generated":{"line":1,"column":193}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"pipeline","original":{"line":16,"column":4},"generated":{"line":1,"column":201}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"push","original":{"line":16,"column":13},"generated":{"line":1,"column":203}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":16,"column":18},"generated":{"line":1,"column":208}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"$group","original":{"line":16,"column":20},"generated":{"line":1,"column":209}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":16,"column":28},"generated":{"line":1,"column":216}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"_id","original":{"line":16,"column":30},"generated":{"line":1,"column":217}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":16,"column":35},"generated":{"line":1,"column":221}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"n","original":{"line":16,"column":38},"generated":{"line":1,"column":223}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":16,"column":41},"generated":{"line":1,"column":225}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"$sum","original":{"line":16,"column":43},"generated":{"line":1,"column":226}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":16,"column":49},"generated":{"line":1,"column":231}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"collection","original":{"line":18,"column":10},"generated":{"line":1,"column":237}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"collection","original":{"line":18,"column":10},"generated":{"line":1,"column":243}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"pipeline","original":{"line":18,"column":22},"generated":{"line":1,"column":245}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"options","original":{"line":18,"column":32},"generated":{"line":1,"column":247}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"execute","original":{"line":21,"column":2},"generated":{"line":1,"column":250}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"server","original":{"line":21,"column":10},"generated":{"line":1,"column":258}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"callback","original":{"line":21,"column":18},"generated":{"line":1,"column":260}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"execute","original":{"line":22,"column":10},"generated":{"line":1,"column":263}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"execute","original":{"line":22,"column":10},"generated":{"line":1,"column":269}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"server","original":{"line":22,"column":18},"generated":{"line":1,"column":277}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":22,"column":26},"generated":{"line":1,"column":279}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"err","original":{"line":22,"column":27},"generated":{"line":1,"column":280}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"result","original":{"line":22,"column":32},"generated":{"line":1,"column":282}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"err","original":{"line":23,"column":10},"generated":{"line":1,"column":287}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"err","original":{"line":23,"column":10},"generated":{"line":1,"column":290}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":25,"column":8},"generated":{"line":1,"column":292}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"callback","original":{"line":24,"column":8},"generated":{"line":1,"column":304}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"err","original":{"line":24,"column":17},"generated":{"line":1,"column":306}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":24,"column":22},"generated":{"line":1,"column":308}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"response","original":{"line":29,"column":12},"generated":{"line":1,"column":314}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"response","original":{"line":29,"column":12},"generated":{"line":1,"column":320}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"result","original":{"line":29,"column":23},"generated":{"line":1,"column":322}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"result","original":{"line":29,"column":30},"generated":{"line":1,"column":324}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"response","original":{"line":30,"column":10},"generated":{"line":1,"column":331}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":30,"column":29},"generated":{"line":1,"column":334}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"response","original":{"line":30,"column":10},"generated":{"line":1,"column":340}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"cursor","original":{"line":30,"column":19},"generated":{"line":1,"column":342}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":30,"column":67},"generated":{"line":1,"column":350}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"response","original":{"line":30,"column":37},"generated":{"line":1,"column":356}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"cursor","original":{"line":30,"column":46},"generated":{"line":1,"column":358}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"firstBatch","original":{"line":30,"column":53},"generated":{"line":1,"column":365}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":32,"column":8},"generated":{"line":1,"column":376}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"callback","original":{"line":31,"column":8},"generated":{"line":1,"column":388}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":31,"column":17},"generated":{"line":1,"column":390}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":31,"column":23},"generated":{"line":1,"column":395}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"docs","original":{"line":35,"column":12},"generated":{"line":1,"column":398}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"docs","original":{"line":35,"column":12},"generated":{"line":1,"column":404}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"response","original":{"line":35,"column":19},"generated":{"line":1,"column":406}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"cursor","original":{"line":35,"column":28},"generated":{"line":1,"column":408}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"firstBatch","original":{"line":35,"column":35},"generated":{"line":1,"column":415}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"callback","original":{"line":36,"column":6},"generated":{"line":1,"column":426}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":36,"column":15},"generated":{"line":1,"column":428}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"docs","original":{"line":36,"column":21},"generated":{"line":1,"column":433}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"length","original":{"line":36,"column":26},"generated":{"line":1,"column":435}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"docs","original":{"line":36,"column":35},"generated":{"line":1,"column":442}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":36,"column":40},"generated":{"line":1,"column":444}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"n","original":{"line":36,"column":43},"generated":{"line":1,"column":447}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","original":{"line":36,"column":47},"generated":{"line":1,"column":449}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"module","original":{"line":41,"column":0},"generated":{"line":1,"column":455}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"exports","original":{"line":41,"column":7},"generated":{"line":1,"column":462}},{"source":"../node_modules/mongodb/lib/operations/count_documents.js","name":"CountDocumentsOperation","original":{"line":41,"column":17},"generated":{"line":1,"column":470}}],"sources":{"../node_modules/mongodb/lib/operations/count_documents.js":"'use strict';\n\nconst AggregateOperation = require('./aggregate');\n\nclass CountDocumentsOperation extends AggregateOperation {\n  constructor(collection, query, options) {\n    const pipeline = [{ $match: query }];\n    if (typeof options.skip === 'number') {\n      pipeline.push({ $skip: options.skip });\n    }\n\n    if (typeof options.limit === 'number') {\n      pipeline.push({ $limit: options.limit });\n    }\n\n    pipeline.push({ $group: { _id: 1, n: { $sum: 1 } } });\n\n    super(collection, pipeline, options);\n  }\n\n  execute(server, callback) {\n    super.execute(server, (err, result) => {\n      if (err) {\n        callback(err, null);\n        return;\n      }\n\n      // NOTE: We're avoiding creating a cursor here to reduce the callstack.\n      const response = result.result;\n      if (response.cursor == null || response.cursor.firstBatch == null) {\n        callback(null, 0);\n        return;\n      }\n\n      const docs = response.cursor.firstBatch;\n      callback(null, docs.length ? docs[0].n : 0);\n    });\n  }\n}\n\nmodule.exports = CountDocumentsOperation;\n"},"lineCount":null}},"error":null,"hash":"e87255ce954120447915eae81c8e4d87","cacheData":{"env":{}}}