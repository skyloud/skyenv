{"id":"qJXE","dependencies":[{"name":"/Users/etienne/skyenv/package.json","includedInParent":true,"mtime":1596478551490},{"name":"/Users/etienne/skyenv/node_modules/mongodb/package.json","includedInParent":true,"mtime":1596467161400},{"name":"./command_v2","loc":{"line":3,"column":35},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/aggregate.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/command_v2.js"},{"name":"../core","loc":{"line":6,"column":31},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/aggregate.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/index.js"},{"name":"../core/utils","loc":{"line":5,"column":31},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/aggregate.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/utils.js"},{"name":"./operation","loc":{"line":8,"column":30},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/aggregate.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/operations/operation.js"}],"generated":{"js":"\"use strict\";function e(t){return(e=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(t)}const t=require(\"./command_v2\"),i=require(\"../core\").MongoError,r=require(\"../core/utils\").maxWireVersion,n=require(\"../core\").ReadPreference,o=require(\"./operation\").Aspect,s=require(\"./operation\").defineAspects,a=1,c=8;class l extends t{constructor(t,r,o){if(super(t,o,{fullResponse:!0}),this.target=t.s.namespace&&t.s.namespace.collection?t.s.namespace.collection:a,this.pipeline=r,this.hasWriteStage=!1,\"string\"==typeof o.out)this.pipeline=this.pipeline.concat({$out:o.out}),this.hasWriteStage=!0;else if(r.length>0){const e=r[r.length-1];(e.$out||e.$merge)&&(this.hasWriteStage=!0)}if(this.hasWriteStage&&(this.readPreference=n.primary),o.explain&&(this.readConcern||this.writeConcern))throw new i('\"explain\" cannot be used on an aggregate call with readConcern/writeConcern');if(null!=o.cursor&&\"object\"!==e(o.cursor))throw new i(\"cursor options must be an object\")}get canRetryRead(){return!this.hasWriteStage}addToPipeline(e){this.pipeline.push(e)}execute(e,t){const i=this.options,n=r(e),o={aggregate:this.target,pipeline:this.pipeline};this.hasWriteStage&&n<c&&(this.readConcern=null),n>=5&&this.hasWriteStage&&this.writeConcern&&Object.assign(o,{writeConcern:this.writeConcern}),!0===i.bypassDocumentValidation&&(o.bypassDocumentValidation=i.bypassDocumentValidation),\"boolean\"==typeof i.allowDiskUse&&(o.allowDiskUse=i.allowDiskUse),i.hint&&(o.hint=i.hint),i.explain&&(i.full=!1,o.explain=i.explain),o.cursor=i.cursor||{},i.batchSize&&!this.hasWriteStage&&(o.cursor.batchSize=i.batchSize),super.executeCommand(e,o,t)}}s(l,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]),module.exports=l;"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":13}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":22}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":24}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":27}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":34}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":36}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":55}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":63}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":80}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":87}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":96}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":105}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":108}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":122}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":125}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":134}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":137}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":144}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":147}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":166}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":174}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":176}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":190}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":198}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":202}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":209}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":219}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":235}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":106,"column":0},"generated":{"line":1,"column":239}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":3,"column":0},"generated":{"line":1,"column":242}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"CommandOperationV2","original":{"line":3,"column":6},"generated":{"line":1,"column":248}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"require","original":{"line":3,"column":27},"generated":{"line":1,"column":250}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":3,"column":35},"generated":{"line":1,"column":258}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"MongoError","original":{"line":4,"column":6},"generated":{"line":1,"column":274}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"require","original":{"line":4,"column":19},"generated":{"line":1,"column":276}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":4,"column":27},"generated":{"line":1,"column":284}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"MongoError","original":{"line":4,"column":38},"generated":{"line":1,"column":295}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"maxWireVersion","original":{"line":5,"column":6},"generated":{"line":1,"column":306}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"require","original":{"line":5,"column":23},"generated":{"line":1,"column":308}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":5,"column":31},"generated":{"line":1,"column":316}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"maxWireVersion","original":{"line":5,"column":48},"generated":{"line":1,"column":333}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"ReadPreference","original":{"line":6,"column":6},"generated":{"line":1,"column":348}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"require","original":{"line":6,"column":23},"generated":{"line":1,"column":350}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":6,"column":31},"generated":{"line":1,"column":358}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"ReadPreference","original":{"line":6,"column":42},"generated":{"line":1,"column":369}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"Aspect","original":{"line":7,"column":6},"generated":{"line":1,"column":384}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"require","original":{"line":7,"column":15},"generated":{"line":1,"column":386}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":7,"column":23},"generated":{"line":1,"column":394}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"Aspect","original":{"line":7,"column":38},"generated":{"line":1,"column":409}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"defineAspects","original":{"line":8,"column":6},"generated":{"line":1,"column":416}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"require","original":{"line":8,"column":22},"generated":{"line":1,"column":418}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":8,"column":30},"generated":{"line":1,"column":426}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"defineAspects","original":{"line":8,"column":45},"generated":{"line":1,"column":441}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"DB_AGGREGATE_COLLECTION","original":{"line":10,"column":6},"generated":{"line":1,"column":455}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":10,"column":32},"generated":{"line":1,"column":457}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT","original":{"line":11,"column":6},"generated":{"line":1,"column":459}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":11,"column":51},"generated":{"line":1,"column":461}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":13,"column":0},"generated":{"line":1,"column":463}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"AggregateOperation","original":{"line":13,"column":6},"generated":{"line":1,"column":469}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"CommandOperationV2","original":{"line":13,"column":33},"generated":{"line":1,"column":479}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"constructor","original":{"line":14,"column":2},"generated":{"line":1,"column":481}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"parent","original":{"line":14,"column":14},"generated":{"line":1,"column":493}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":14,"column":22},"generated":{"line":1,"column":495}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":14,"column":32},"generated":{"line":1,"column":497}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":26,"column":8},"generated":{"line":1,"column":500}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"parent","original":{"line":15,"column":10},"generated":{"line":1,"column":503}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"parent","original":{"line":15,"column":10},"generated":{"line":1,"column":509}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":15,"column":18},"generated":{"line":1,"column":511}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":15,"column":27},"generated":{"line":1,"column":513}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"fullResponse","original":{"line":15,"column":29},"generated":{"line":1,"column":514}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":15,"column":43},"generated":{"line":1,"column":528}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"target","original":{"line":17,"column":9},"generated":{"line":1,"column":532}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"target","original":{"line":17,"column":9},"generated":{"line":1,"column":537}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"parent","original":{"line":18,"column":6},"generated":{"line":1,"column":544}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"s","original":{"line":18,"column":13},"generated":{"line":1,"column":546}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"namespace","original":{"line":18,"column":15},"generated":{"line":1,"column":548}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"parent","original":{"line":18,"column":28},"generated":{"line":1,"column":559}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"s","original":{"line":18,"column":35},"generated":{"line":1,"column":561}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"namespace","original":{"line":18,"column":37},"generated":{"line":1,"column":563}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"collection","original":{"line":18,"column":47},"generated":{"line":1,"column":573}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"parent","original":{"line":19,"column":10},"generated":{"line":1,"column":584}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"s","original":{"line":19,"column":17},"generated":{"line":1,"column":586}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"namespace","original":{"line":19,"column":19},"generated":{"line":1,"column":588}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"collection","original":{"line":19,"column":29},"generated":{"line":1,"column":598}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"DB_AGGREGATE_COLLECTION","original":{"line":20,"column":10},"generated":{"line":1,"column":609}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":22,"column":9},"generated":{"line":1,"column":611}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":22,"column":9},"generated":{"line":1,"column":616}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":22,"column":20},"generated":{"line":1,"column":625}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":25,"column":9},"generated":{"line":1,"column":627}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":25,"column":9},"generated":{"line":1,"column":632}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":25,"column":25},"generated":{"line":1,"column":647}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":26,"column":31},"generated":{"line":1,"column":649}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":26,"column":15},"generated":{"line":1,"column":666}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"out","original":{"line":26,"column":23},"generated":{"line":1,"column":668}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":27,"column":11},"generated":{"line":1,"column":672}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":27,"column":11},"generated":{"line":1,"column":677}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":27,"column":22},"generated":{"line":1,"column":686}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":27,"column":27},"generated":{"line":1,"column":691}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"concat","original":{"line":27,"column":36},"generated":{"line":1,"column":700}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":27,"column":43},"generated":{"line":1,"column":707}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"$out","original":{"line":27,"column":45},"generated":{"line":1,"column":708}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":27,"column":51},"generated":{"line":1,"column":713}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"out","original":{"line":27,"column":59},"generated":{"line":1,"column":715}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":28,"column":11},"generated":{"line":1,"column":721}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":28,"column":11},"generated":{"line":1,"column":726}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":28,"column":27},"generated":{"line":1,"column":741}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":29,"column":11},"generated":{"line":1,"column":748}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":29,"column":15},"generated":{"line":1,"column":751}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"length","original":{"line":29,"column":24},"generated":{"line":1,"column":753}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":29,"column":33},"generated":{"line":1,"column":760}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":29,"column":36},"generated":{"line":1,"column":762}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"finalStage","original":{"line":30,"column":12},"generated":{"line":1,"column":763}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"finalStage","original":{"line":30,"column":12},"generated":{"line":1,"column":769}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":30,"column":25},"generated":{"line":1,"column":771}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":30,"column":34},"generated":{"line":1,"column":773}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"length","original":{"line":30,"column":43},"generated":{"line":1,"column":775}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":30,"column":52},"generated":{"line":1,"column":782}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"finalStage","original":{"line":31,"column":10},"generated":{"line":1,"column":786}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"$out","original":{"line":31,"column":21},"generated":{"line":1,"column":788}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"finalStage","original":{"line":31,"column":29},"generated":{"line":1,"column":794}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"$merge","original":{"line":31,"column":40},"generated":{"line":1,"column":796}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":32,"column":13},"generated":{"line":1,"column":806}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":32,"column":13},"generated":{"line":1,"column":811}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":32,"column":29},"generated":{"line":1,"column":826}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":40,"column":8},"generated":{"line":1,"column":829}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":36,"column":8},"generated":{"line":1,"column":832}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":36,"column":13},"generated":{"line":1,"column":837}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"readPreference","original":{"line":37,"column":11},"generated":{"line":1,"column":853}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"readPreference","original":{"line":37,"column":11},"generated":{"line":1,"column":858}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"ReadPreference","original":{"line":37,"column":28},"generated":{"line":1,"column":873}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"primary","original":{"line":37,"column":43},"generated":{"line":1,"column":875}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":40,"column":8},"generated":{"line":1,"column":884}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"explain","original":{"line":40,"column":16},"generated":{"line":1,"column":886}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":40,"column":28},"generated":{"line":1,"column":896}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"readConcern","original":{"line":40,"column":33},"generated":{"line":1,"column":901}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":40,"column":48},"generated":{"line":1,"column":914}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"writeConcern","original":{"line":40,"column":53},"generated":{"line":1,"column":919}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":41,"column":12},"generated":{"line":1,"column":933}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":41,"column":12},"generated":{"line":1,"column":939}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"MongoError","original":{"line":41,"column":16},"generated":{"line":1,"column":943}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":42,"column":8},"generated":{"line":1,"column":945}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":46,"column":8},"generated":{"line":1,"column":1024}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":46,"column":26},"generated":{"line":1,"column":1027}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":46,"column":8},"generated":{"line":1,"column":1033}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"cursor","original":{"line":46,"column":16},"generated":{"line":1,"column":1035}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":46,"column":60},"generated":{"line":1,"column":1043}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":46,"column":34},"generated":{"line":1,"column":1054}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":46,"column":41},"generated":{"line":1,"column":1056}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"cursor","original":{"line":46,"column":49},"generated":{"line":1,"column":1058}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":47,"column":12},"generated":{"line":1,"column":1066}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":47,"column":12},"generated":{"line":1,"column":1072}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"MongoError","original":{"line":47,"column":16},"generated":{"line":1,"column":1076}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":47,"column":27},"generated":{"line":1,"column":1078}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"canRetryRead","original":{"line":51,"column":6},"generated":{"line":1,"column":1114}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":52,"column":11},"generated":{"line":1,"column":1133}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":52,"column":12},"generated":{"line":1,"column":1140}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":52,"column":17},"generated":{"line":1,"column":1145}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"addToPipeline","original":{"line":55,"column":2},"generated":{"line":1,"column":1159}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"stage","original":{"line":55,"column":16},"generated":{"line":1,"column":1173}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":56,"column":9},"generated":{"line":1,"column":1176}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":56,"column":9},"generated":{"line":1,"column":1181}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"push","original":{"line":56,"column":18},"generated":{"line":1,"column":1190}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"stage","original":{"line":56,"column":23},"generated":{"line":1,"column":1195}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"execute","original":{"line":59,"column":2},"generated":{"line":1,"column":1198}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"server","original":{"line":59,"column":10},"generated":{"line":1,"column":1206}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"callback","original":{"line":59,"column":18},"generated":{"line":1,"column":1208}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":60,"column":10},"generated":{"line":1,"column":1211}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":60,"column":10},"generated":{"line":1,"column":1217}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":60,"column":20},"generated":{"line":1,"column":1219}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":60,"column":25},"generated":{"line":1,"column":1224}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"serverWireVersion","original":{"line":61,"column":10},"generated":{"line":1,"column":1232}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"maxWireVersion","original":{"line":61,"column":30},"generated":{"line":1,"column":1234}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"server","original":{"line":61,"column":45},"generated":{"line":1,"column":1236}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":62,"column":10},"generated":{"line":1,"column":1239}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":62,"column":20},"generated":{"line":1,"column":1241}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"aggregate","original":{"line":62,"column":22},"generated":{"line":1,"column":1242}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":62,"column":33},"generated":{"line":1,"column":1252}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"target","original":{"line":62,"column":38},"generated":{"line":1,"column":1257}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":62,"column":46},"generated":{"line":1,"column":1264}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":62,"column":56},"generated":{"line":1,"column":1273}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"pipeline","original":{"line":62,"column":61},"generated":{"line":1,"column":1278}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":64,"column":8},"generated":{"line":1,"column":1288}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":64,"column":13},"generated":{"line":1,"column":1293}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"serverWireVersion","original":{"line":64,"column":30},"generated":{"line":1,"column":1308}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT","original":{"line":64,"column":50},"generated":{"line":1,"column":1310}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"readConcern","original":{"line":65,"column":11},"generated":{"line":1,"column":1314}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"readConcern","original":{"line":65,"column":11},"generated":{"line":1,"column":1319}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":65,"column":25},"generated":{"line":1,"column":1331}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"serverWireVersion","original":{"line":68,"column":8},"generated":{"line":1,"column":1337}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":68,"column":29},"generated":{"line":1,"column":1340}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":69,"column":10},"generated":{"line":1,"column":1343}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":69,"column":15},"generated":{"line":1,"column":1348}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":69,"column":32},"generated":{"line":1,"column":1363}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"writeConcern","original":{"line":69,"column":37},"generated":{"line":1,"column":1368}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"Object","original":{"line":70,"column":8},"generated":{"line":1,"column":1382}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"assign","original":{"line":70,"column":15},"generated":{"line":1,"column":1389}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":70,"column":22},"generated":{"line":1,"column":1396}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":70,"column":31},"generated":{"line":1,"column":1398}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"writeConcern","original":{"line":70,"column":33},"generated":{"line":1,"column":1399}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":70,"column":47},"generated":{"line":1,"column":1412}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"writeConcern","original":{"line":70,"column":52},"generated":{"line":1,"column":1417}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":74,"column":45},"generated":{"line":1,"column":1433}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":74,"column":8},"generated":{"line":1,"column":1437}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"bypassDocumentValidation","original":{"line":74,"column":16},"generated":{"line":1,"column":1439}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":75,"column":6},"generated":{"line":1,"column":1466}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"bypassDocumentValidation","original":{"line":75,"column":14},"generated":{"line":1,"column":1468}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":75,"column":41},"generated":{"line":1,"column":1493}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"bypassDocumentValidation","original":{"line":75,"column":49},"generated":{"line":1,"column":1495}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":78,"column":40},"generated":{"line":1,"column":1521}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":78,"column":15},"generated":{"line":1,"column":1539}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"allowDiskUse","original":{"line":78,"column":23},"generated":{"line":1,"column":1541}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":79,"column":6},"generated":{"line":1,"column":1556}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"allowDiskUse","original":{"line":79,"column":14},"generated":{"line":1,"column":1558}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":79,"column":29},"generated":{"line":1,"column":1571}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"allowDiskUse","original":{"line":79,"column":37},"generated":{"line":1,"column":1573}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":82,"column":8},"generated":{"line":1,"column":1587}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hint","original":{"line":82,"column":16},"generated":{"line":1,"column":1589}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":83,"column":6},"generated":{"line":1,"column":1596}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hint","original":{"line":83,"column":14},"generated":{"line":1,"column":1598}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":83,"column":21},"generated":{"line":1,"column":1603}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hint","original":{"line":83,"column":29},"generated":{"line":1,"column":1605}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":86,"column":8},"generated":{"line":1,"column":1611}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"explain","original":{"line":86,"column":16},"generated":{"line":1,"column":1613}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":87,"column":6},"generated":{"line":1,"column":1623}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"full","original":{"line":87,"column":14},"generated":{"line":1,"column":1625}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":87,"column":21},"generated":{"line":1,"column":1631}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":88,"column":6},"generated":{"line":1,"column":1633}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"explain","original":{"line":88,"column":14},"generated":{"line":1,"column":1635}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":88,"column":24},"generated":{"line":1,"column":1643}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"explain","original":{"line":88,"column":32},"generated":{"line":1,"column":1645}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":91,"column":4},"generated":{"line":1,"column":1654}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"cursor","original":{"line":91,"column":12},"generated":{"line":1,"column":1656}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":91,"column":21},"generated":{"line":1,"column":1663}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"cursor","original":{"line":91,"column":29},"generated":{"line":1,"column":1665}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":91,"column":39},"generated":{"line":1,"column":1673}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":92,"column":8},"generated":{"line":1,"column":1676}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"batchSize","original":{"line":92,"column":16},"generated":{"line":1,"column":1678}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":92,"column":30},"generated":{"line":1,"column":1690}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"hasWriteStage","original":{"line":92,"column":35},"generated":{"line":1,"column":1695}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":93,"column":6},"generated":{"line":1,"column":1711}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"cursor","original":{"line":93,"column":14},"generated":{"line":1,"column":1713}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"batchSize","original":{"line":93,"column":21},"generated":{"line":1,"column":1720}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"options","original":{"line":93,"column":33},"generated":{"line":1,"column":1730}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"batchSize","original":{"line":93,"column":41},"generated":{"line":1,"column":1732}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"executeCommand","original":{"line":96,"column":10},"generated":{"line":1,"column":1743}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"executeCommand","original":{"line":96,"column":10},"generated":{"line":1,"column":1749}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"server","original":{"line":96,"column":25},"generated":{"line":1,"column":1764}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"command","original":{"line":96,"column":33},"generated":{"line":1,"column":1766}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"callback","original":{"line":96,"column":42},"generated":{"line":1,"column":1768}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"defineAspects","original":{"line":100,"column":0},"generated":{"line":1,"column":1772}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"AggregateOperation","original":{"line":100,"column":14},"generated":{"line":1,"column":1774}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","original":{"line":100,"column":34},"generated":{"line":1,"column":1776}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"Aspect","original":{"line":101,"column":2},"generated":{"line":1,"column":1777}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"READ_OPERATION","original":{"line":101,"column":9},"generated":{"line":1,"column":1779}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"Aspect","original":{"line":102,"column":2},"generated":{"line":1,"column":1794}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"RETRYABLE","original":{"line":102,"column":9},"generated":{"line":1,"column":1796}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"Aspect","original":{"line":103,"column":2},"generated":{"line":1,"column":1806}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"EXECUTE_WITH_SELECTION","original":{"line":103,"column":9},"generated":{"line":1,"column":1808}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"module","original":{"line":106,"column":0},"generated":{"line":1,"column":1833}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"exports","original":{"line":106,"column":7},"generated":{"line":1,"column":1840}},{"source":"../node_modules/mongodb/lib/operations/aggregate.js","name":"AggregateOperation","original":{"line":106,"column":17},"generated":{"line":1,"column":1848}}],"sources":{"../node_modules/mongodb/lib/operations/aggregate.js":"'use strict';\n\nconst CommandOperationV2 = require('./command_v2');\nconst MongoError = require('../core').MongoError;\nconst maxWireVersion = require('../core/utils').maxWireVersion;\nconst ReadPreference = require('../core').ReadPreference;\nconst Aspect = require('./operation').Aspect;\nconst defineAspects = require('./operation').defineAspects;\n\nconst DB_AGGREGATE_COLLECTION = 1;\nconst MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT = 8;\n\nclass AggregateOperation extends CommandOperationV2 {\n  constructor(parent, pipeline, options) {\n    super(parent, options, { fullResponse: true });\n\n    this.target =\n      parent.s.namespace && parent.s.namespace.collection\n        ? parent.s.namespace.collection\n        : DB_AGGREGATE_COLLECTION;\n\n    this.pipeline = pipeline;\n\n    // determine if we have a write stage, override read preference if so\n    this.hasWriteStage = false;\n    if (typeof options.out === 'string') {\n      this.pipeline = this.pipeline.concat({ $out: options.out });\n      this.hasWriteStage = true;\n    } else if (pipeline.length > 0) {\n      const finalStage = pipeline[pipeline.length - 1];\n      if (finalStage.$out || finalStage.$merge) {\n        this.hasWriteStage = true;\n      }\n    }\n\n    if (this.hasWriteStage) {\n      this.readPreference = ReadPreference.primary;\n    }\n\n    if (options.explain && (this.readConcern || this.writeConcern)) {\n      throw new MongoError(\n        '\"explain\" cannot be used on an aggregate call with readConcern/writeConcern'\n      );\n    }\n\n    if (options.cursor != null && typeof options.cursor !== 'object') {\n      throw new MongoError('cursor options must be an object');\n    }\n  }\n\n  get canRetryRead() {\n    return !this.hasWriteStage;\n  }\n\n  addToPipeline(stage) {\n    this.pipeline.push(stage);\n  }\n\n  execute(server, callback) {\n    const options = this.options;\n    const serverWireVersion = maxWireVersion(server);\n    const command = { aggregate: this.target, pipeline: this.pipeline };\n\n    if (this.hasWriteStage && serverWireVersion < MIN_WIRE_VERSION_$OUT_READ_CONCERN_SUPPORT) {\n      this.readConcern = null;\n    }\n\n    if (serverWireVersion >= 5) {\n      if (this.hasWriteStage && this.writeConcern) {\n        Object.assign(command, { writeConcern: this.writeConcern });\n      }\n    }\n\n    if (options.bypassDocumentValidation === true) {\n      command.bypassDocumentValidation = options.bypassDocumentValidation;\n    }\n\n    if (typeof options.allowDiskUse === 'boolean') {\n      command.allowDiskUse = options.allowDiskUse;\n    }\n\n    if (options.hint) {\n      command.hint = options.hint;\n    }\n\n    if (options.explain) {\n      options.full = false;\n      command.explain = options.explain;\n    }\n\n    command.cursor = options.cursor || {};\n    if (options.batchSize && !this.hasWriteStage) {\n      command.cursor.batchSize = options.batchSize;\n    }\n\n    super.executeCommand(server, command, callback);\n  }\n}\n\ndefineAspects(AggregateOperation, [\n  Aspect.READ_OPERATION,\n  Aspect.RETRYABLE,\n  Aspect.EXECUTE_WITH_SELECTION\n]);\n\nmodule.exports = AggregateOperation;\n"},"lineCount":null}},"error":null,"hash":"86433c1181f2c923ceca2245399b4b73","cacheData":{"env":{}}}