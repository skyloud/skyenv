{"id":"wYmT","dependencies":[{"name":"/Users/etienne/skyenv/package.json","includedInParent":true,"mtime":1596478551490},{"name":"/Users/etienne/skyenv/node_modules/mongodb/package.json","includedInParent":true,"mtime":1596467161400},{"name":"../connection/logger","loc":{"line":3,"column":23},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/sdam/srv_polling.js","resolved":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/connection/logger.js"},{"name":"events","loc":{"line":4,"column":29},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/sdam/srv_polling.js","resolved":"/Users/etienne/skyenv/node_modules/events/events.js"},{"name":"dns","loc":{"line":5,"column":20},"parent":"/Users/etienne/skyenv/node_modules/mongodb/lib/core/sdam/srv_polling.js","resolved":"/Users/etienne/skyenv/node_modules/parcel-bundler/src/builtins/_empty.js"}],"generated":{"js":"\"use strict\";const t=require(\"../connection/logger\"),e=require(\"events\").EventEmitter,s=require(\"dns\");function r(t,e){const s=/^.*?\\./,r=\".\".concat(t.replace(s,\"\")),i=\".\".concat(e.replace(s,\"\"));return r.endsWith(i)}class i{constructor(t){this.srvRecords=t}addresses(){return new Set(this.srvRecords.map(t=>\"\".concat(t.name,\":\").concat(t.port)))}}class o extends e{constructor(e){if(super(),!e||!e.srvHost)throw new TypeError(\"options for SrvPoller must exist and include srvHost\");this.srvHost=e.srvHost,this.rescanSrvIntervalMS=6e4,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.logger=t(\"srvPoller\",e),this.haMode=!1,this.generation=0,this._timeout=null}get srvAddress(){return\"_mongodb._tcp.\".concat(this.srvHost)}get intervalMS(){return this.haMode?this.heartbeatFrequencyMS:this.rescanSrvIntervalMS}start(){this._timeout||this.schedule()}stop(){this._timeout&&(clearTimeout(this._timeout),this.generation+=1,this._timeout=null)}schedule(){clearTimeout(this._timeout),this._timeout=setTimeout(()=>this._poll(),this.intervalMS)}success(t){this.haMode=!1,this.schedule(),this.emit(\"srvRecordDiscovery\",new i(t))}failure(t,e){this.logger.warn(t,e),this.haMode=!0,this.schedule()}parentDomainMismatch(t){this.logger.warn(\"parent domain mismatch on SRV record (\".concat(t.name,\":\").concat(t.port,\")\"),t)}_poll(){const t=this.generation;s.resolveSrv(this.srvAddress,(e,s)=>{if(t!==this.generation)return;if(e)return void this.failure(\"DNS error\",e);const i=[];s.forEach(t=>{r(t.name,this.srvHost)?i.push(t):this.parentDomainMismatch(t)}),i.length?this.success(i):this.failure(\"No valid addresses found at host\")})}}module.exports.SrvPollingEvent=i,module.exports.SrvPoller=o;"},"sourceMaps":{"js":{"mappings":[{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":1,"column":0},"generated":{"line":1,"column":0}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":3,"column":0},"generated":{"line":1,"column":13}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"Logger","original":{"line":3,"column":6},"generated":{"line":1,"column":19}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"require","original":{"line":3,"column":15},"generated":{"line":1,"column":21}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":3,"column":23},"generated":{"line":1,"column":29}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"EventEmitter","original":{"line":4,"column":6},"generated":{"line":1,"column":53}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"require","original":{"line":4,"column":21},"generated":{"line":1,"column":55}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":4,"column":29},"generated":{"line":1,"column":63}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"EventEmitter","original":{"line":4,"column":39},"generated":{"line":1,"column":73}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"dns","original":{"line":5,"column":6},"generated":{"line":1,"column":86}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"require","original":{"line":5,"column":12},"generated":{"line":1,"column":88}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":5,"column":20},"generated":{"line":1,"column":96}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":14,"column":0},"generated":{"line":1,"column":103}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"matchesParentDomain","original":{"line":14,"column":9},"generated":{"line":1,"column":112}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvAddress","original":{"line":14,"column":29},"generated":{"line":1,"column":114}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parentDomain","original":{"line":14,"column":41},"generated":{"line":1,"column":116}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"regex","original":{"line":15,"column":8},"generated":{"line":1,"column":119}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"regex","original":{"line":15,"column":8},"generated":{"line":1,"column":125}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":15,"column":16},"generated":{"line":1,"column":127}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srv","original":{"line":16,"column":8},"generated":{"line":1,"column":136}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvAddress","original":{"line":16,"column":18},"generated":{"line":1,"column":138}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvAddress","original":{"line":16,"column":18},"generated":{"line":1,"column":142}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvAddress","original":{"line":16,"column":18},"generated":{"line":1,"column":149}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"replace","original":{"line":16,"column":29},"generated":{"line":1,"column":151}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"regex","original":{"line":16,"column":37},"generated":{"line":1,"column":159}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":16,"column":44},"generated":{"line":1,"column":161}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parent","original":{"line":17,"column":8},"generated":{"line":1,"column":166}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parentDomain","original":{"line":17,"column":21},"generated":{"line":1,"column":168}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parentDomain","original":{"line":17,"column":21},"generated":{"line":1,"column":172}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parentDomain","original":{"line":17,"column":21},"generated":{"line":1,"column":179}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"replace","original":{"line":17,"column":34},"generated":{"line":1,"column":181}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"regex","original":{"line":17,"column":42},"generated":{"line":1,"column":189}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":17,"column":49},"generated":{"line":1,"column":191}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srv","original":{"line":18,"column":9},"generated":{"line":1,"column":196}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srv","original":{"line":18,"column":9},"generated":{"line":1,"column":203}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"endsWith","original":{"line":18,"column":13},"generated":{"line":1,"column":205}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parent","original":{"line":18,"column":22},"generated":{"line":1,"column":214}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":21,"column":0},"generated":{"line":1,"column":217}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"SrvPollingEvent","original":{"line":21,"column":6},"generated":{"line":1,"column":223}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"constructor","original":{"line":22,"column":2},"generated":{"line":1,"column":225}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":22,"column":14},"generated":{"line":1,"column":237}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":23,"column":9},"generated":{"line":1,"column":240}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":23,"column":9},"generated":{"line":1,"column":245}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":23,"column":22},"generated":{"line":1,"column":256}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"addresses","original":{"line":26,"column":2},"generated":{"line":1,"column":258}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":27,"column":11},"generated":{"line":1,"column":270}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":27,"column":11},"generated":{"line":1,"column":277}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"Set","original":{"line":27,"column":15},"generated":{"line":1,"column":281}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":27,"column":19},"generated":{"line":1,"column":285}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":27,"column":24},"generated":{"line":1,"column":290}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"map","original":{"line":27,"column":35},"generated":{"line":1,"column":301}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":27,"column":39},"generated":{"line":1,"column":305}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":27,"column":52},"generated":{"line":1,"column":308}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":27,"column":52},"generated":{"line":1,"column":311}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":27,"column":52},"generated":{"line":1,"column":318}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"name","original":{"line":27,"column":59},"generated":{"line":1,"column":320}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":27,"column":67},"generated":{"line":1,"column":325}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":27,"column":67},"generated":{"line":1,"column":330}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":27,"column":67},"generated":{"line":1,"column":337}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"port","original":{"line":27,"column":74},"generated":{"line":1,"column":339}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":31,"column":0},"generated":{"line":1,"column":348}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"SrvPoller","original":{"line":31,"column":6},"generated":{"line":1,"column":354}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"EventEmitter","original":{"line":31,"column":24},"generated":{"line":1,"column":364}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"constructor","original":{"line":39,"column":2},"generated":{"line":1,"column":366}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"options","original":{"line":39,"column":14},"generated":{"line":1,"column":378}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":42,"column":8},"generated":{"line":1,"column":381}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":40,"column":4},"generated":{"line":1,"column":384}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"options","original":{"line":42,"column":9},"generated":{"line":1,"column":393}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"options","original":{"line":42,"column":21},"generated":{"line":1,"column":397}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvHost","original":{"line":42,"column":29},"generated":{"line":1,"column":399}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":43,"column":12},"generated":{"line":1,"column":407}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":43,"column":12},"generated":{"line":1,"column":413}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"TypeError","original":{"line":43,"column":16},"generated":{"line":1,"column":417}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":43,"column":26},"generated":{"line":1,"column":427}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvHost","original":{"line":46,"column":9},"generated":{"line":1,"column":483}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvHost","original":{"line":46,"column":9},"generated":{"line":1,"column":488}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"options","original":{"line":46,"column":19},"generated":{"line":1,"column":496}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvHost","original":{"line":46,"column":27},"generated":{"line":1,"column":498}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"rescanSrvIntervalMS","original":{"line":47,"column":9},"generated":{"line":1,"column":506}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"rescanSrvIntervalMS","original":{"line":47,"column":9},"generated":{"line":1,"column":511}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":47,"column":31},"generated":{"line":1,"column":531}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"heartbeatFrequencyMS","original":{"line":48,"column":9},"generated":{"line":1,"column":535}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"heartbeatFrequencyMS","original":{"line":48,"column":9},"generated":{"line":1,"column":540}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"options","original":{"line":48,"column":32},"generated":{"line":1,"column":561}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"heartbeatFrequencyMS","original":{"line":48,"column":40},"generated":{"line":1,"column":563}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":48,"column":64},"generated":{"line":1,"column":585}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"logger","original":{"line":49,"column":9},"generated":{"line":1,"column":589}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"logger","original":{"line":49,"column":9},"generated":{"line":1,"column":594}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"Logger","original":{"line":49,"column":18},"generated":{"line":1,"column":601}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":49,"column":25},"generated":{"line":1,"column":603}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"options","original":{"line":49,"column":38},"generated":{"line":1,"column":615}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"haMode","original":{"line":51,"column":9},"generated":{"line":1,"column":618}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"haMode","original":{"line":51,"column":9},"generated":{"line":1,"column":623}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":51,"column":18},"generated":{"line":1,"column":631}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":52,"column":9},"generated":{"line":1,"column":633}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":52,"column":9},"generated":{"line":1,"column":638}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":52,"column":22},"generated":{"line":1,"column":649}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":54,"column":9},"generated":{"line":1,"column":651}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":54,"column":9},"generated":{"line":1,"column":656}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":54,"column":20},"generated":{"line":1,"column":665}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvAddress","original":{"line":57,"column":6},"generated":{"line":1,"column":670}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":58,"column":28},"generated":{"line":1,"column":687}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":58,"column":28},"generated":{"line":1,"column":693}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":58,"column":28},"generated":{"line":1,"column":710}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":58,"column":28},"generated":{"line":1,"column":717}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvHost","original":{"line":58,"column":33},"generated":{"line":1,"column":722}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"intervalMS","original":{"line":61,"column":6},"generated":{"line":1,"column":731}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":62,"column":11},"generated":{"line":1,"column":748}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":62,"column":11},"generated":{"line":1,"column":755}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"haMode","original":{"line":62,"column":16},"generated":{"line":1,"column":760}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":62,"column":25},"generated":{"line":1,"column":767}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"heartbeatFrequencyMS","original":{"line":62,"column":30},"generated":{"line":1,"column":772}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":62,"column":53},"generated":{"line":1,"column":793}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"rescanSrvIntervalMS","original":{"line":62,"column":58},"generated":{"line":1,"column":798}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"start","original":{"line":65,"column":2},"generated":{"line":1,"column":818}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":66,"column":9},"generated":{"line":1,"column":826}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":66,"column":14},"generated":{"line":1,"column":831}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"schedule","original":{"line":67,"column":11},"generated":{"line":1,"column":841}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"schedule","original":{"line":67,"column":11},"generated":{"line":1,"column":846}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"stop","original":{"line":71,"column":2},"generated":{"line":1,"column":857}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":72,"column":8},"generated":{"line":1,"column":864}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":72,"column":13},"generated":{"line":1,"column":869}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"clearTimeout","original":{"line":73,"column":6},"generated":{"line":1,"column":880}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":73,"column":19},"generated":{"line":1,"column":893}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":73,"column":24},"generated":{"line":1,"column":898}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":74,"column":11},"generated":{"line":1,"column":908}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":74,"column":11},"generated":{"line":1,"column":913}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":74,"column":25},"generated":{"line":1,"column":925}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":75,"column":11},"generated":{"line":1,"column":927}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":75,"column":11},"generated":{"line":1,"column":932}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":75,"column":22},"generated":{"line":1,"column":941}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"schedule","original":{"line":79,"column":2},"generated":{"line":1,"column":947}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"clearTimeout","original":{"line":80,"column":4},"generated":{"line":1,"column":958}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":80,"column":17},"generated":{"line":1,"column":971}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":80,"column":22},"generated":{"line":1,"column":976}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":81,"column":9},"generated":{"line":1,"column":986}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_timeout","original":{"line":81,"column":9},"generated":{"line":1,"column":991}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"setTimeout","original":{"line":81,"column":20},"generated":{"line":1,"column":1000}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":81,"column":31},"generated":{"line":1,"column":1011}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":81,"column":37},"generated":{"line":1,"column":1015}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_poll","original":{"line":81,"column":42},"generated":{"line":1,"column":1020}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":81,"column":51},"generated":{"line":1,"column":1028}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"intervalMS","original":{"line":81,"column":56},"generated":{"line":1,"column":1033}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"success","original":{"line":84,"column":2},"generated":{"line":1,"column":1045}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":84,"column":10},"generated":{"line":1,"column":1053}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"haMode","original":{"line":85,"column":9},"generated":{"line":1,"column":1056}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"haMode","original":{"line":85,"column":9},"generated":{"line":1,"column":1061}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":85,"column":18},"generated":{"line":1,"column":1069}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"schedule","original":{"line":86,"column":9},"generated":{"line":1,"column":1071}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"schedule","original":{"line":86,"column":9},"generated":{"line":1,"column":1076}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"emit","original":{"line":87,"column":9},"generated":{"line":1,"column":1087}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"emit","original":{"line":87,"column":9},"generated":{"line":1,"column":1092}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":87,"column":14},"generated":{"line":1,"column":1097}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":87,"column":36},"generated":{"line":1,"column":1118}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"SrvPollingEvent","original":{"line":87,"column":40},"generated":{"line":1,"column":1122}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":87,"column":56},"generated":{"line":1,"column":1124}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"failure","original":{"line":90,"column":2},"generated":{"line":1,"column":1128}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"message","original":{"line":90,"column":10},"generated":{"line":1,"column":1136}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"obj","original":{"line":90,"column":19},"generated":{"line":1,"column":1138}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"logger","original":{"line":91,"column":9},"generated":{"line":1,"column":1141}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"logger","original":{"line":91,"column":9},"generated":{"line":1,"column":1146}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"warn","original":{"line":91,"column":16},"generated":{"line":1,"column":1153}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"message","original":{"line":91,"column":21},"generated":{"line":1,"column":1158}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"obj","original":{"line":91,"column":30},"generated":{"line":1,"column":1160}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"haMode","original":{"line":92,"column":9},"generated":{"line":1,"column":1163}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"haMode","original":{"line":92,"column":9},"generated":{"line":1,"column":1168}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":92,"column":18},"generated":{"line":1,"column":1176}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"schedule","original":{"line":93,"column":9},"generated":{"line":1,"column":1178}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"schedule","original":{"line":93,"column":9},"generated":{"line":1,"column":1183}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parentDomainMismatch","original":{"line":96,"column":2},"generated":{"line":1,"column":1194}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":96,"column":23},"generated":{"line":1,"column":1215}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"logger","original":{"line":97,"column":9},"generated":{"line":1,"column":1218}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"logger","original":{"line":97,"column":9},"generated":{"line":1,"column":1223}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"warn","original":{"line":97,"column":16},"generated":{"line":1,"column":1230}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":98,"column":47},"generated":{"line":1,"column":1235}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":98,"column":47},"generated":{"line":1,"column":1276}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":98,"column":47},"generated":{"line":1,"column":1283}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"name","original":{"line":98,"column":57},"generated":{"line":1,"column":1285}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":98,"column":65},"generated":{"line":1,"column":1290}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":98,"column":65},"generated":{"line":1,"column":1295}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":98,"column":65},"generated":{"line":1,"column":1302}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"port","original":{"line":98,"column":75},"generated":{"line":1,"column":1304}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":99,"column":6},"generated":{"line":1,"column":1309}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecord","original":{"line":99,"column":6},"generated":{"line":1,"column":1314}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"_poll","original":{"line":103,"column":2},"generated":{"line":1,"column":1317}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":104,"column":10},"generated":{"line":1,"column":1325}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":104,"column":10},"generated":{"line":1,"column":1331}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":104,"column":23},"generated":{"line":1,"column":1333}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":104,"column":28},"generated":{"line":1,"column":1338}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"dns","original":{"line":105,"column":4},"generated":{"line":1,"column":1349}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"resolveSrv","original":{"line":105,"column":8},"generated":{"line":1,"column":1351}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":105,"column":19},"generated":{"line":1,"column":1362}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvAddress","original":{"line":105,"column":24},"generated":{"line":1,"column":1367}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":105,"column":36},"generated":{"line":1,"column":1378}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"err","original":{"line":105,"column":37},"generated":{"line":1,"column":1379}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":105,"column":42},"generated":{"line":1,"column":1381}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":106,"column":10},"generated":{"line":1,"column":1386}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":106,"column":10},"generated":{"line":1,"column":1389}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":106,"column":25},"generated":{"line":1,"column":1393}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"generation","original":{"line":106,"column":30},"generated":{"line":1,"column":1398}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":107,"column":8},"generated":{"line":1,"column":1409}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"err","original":{"line":110,"column":10},"generated":{"line":1,"column":1416}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"err","original":{"line":110,"column":10},"generated":{"line":1,"column":1419}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":112,"column":8},"generated":{"line":1,"column":1421}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"failure","original":{"line":111,"column":13},"generated":{"line":1,"column":1433}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"failure","original":{"line":111,"column":13},"generated":{"line":1,"column":1438}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":111,"column":21},"generated":{"line":1,"column":1446}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"err","original":{"line":111,"column":34},"generated":{"line":1,"column":1458}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"finalAddresses","original":{"line":115,"column":12},"generated":{"line":1,"column":1461}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"finalAddresses","original":{"line":115,"column":12},"generated":{"line":1,"column":1467}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":115,"column":29},"generated":{"line":1,"column":1469}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvRecords","original":{"line":116,"column":6},"generated":{"line":1,"column":1472}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"forEach","original":{"line":116,"column":17},"generated":{"line":1,"column":1474}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":116,"column":25},"generated":{"line":1,"column":1482}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"matchesParentDomain","original":{"line":117,"column":12},"generated":{"line":1,"column":1486}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":117,"column":32},"generated":{"line":1,"column":1488}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"name","original":{"line":117,"column":39},"generated":{"line":1,"column":1490}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":117,"column":45},"generated":{"line":1,"column":1495}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"srvHost","original":{"line":117,"column":50},"generated":{"line":1,"column":1500}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"finalAddresses","original":{"line":118,"column":10},"generated":{"line":1,"column":1509}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"push","original":{"line":118,"column":25},"generated":{"line":1,"column":1511}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":118,"column":30},"generated":{"line":1,"column":1516}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parentDomainMismatch","original":{"line":120,"column":15},"generated":{"line":1,"column":1519}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"parentDomainMismatch","original":{"line":120,"column":15},"generated":{"line":1,"column":1524}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"record","original":{"line":120,"column":36},"generated":{"line":1,"column":1545}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"finalAddresses","original":{"line":124,"column":11},"generated":{"line":1,"column":1550}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"length","original":{"line":124,"column":26},"generated":{"line":1,"column":1552}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"success","original":{"line":129,"column":11},"generated":{"line":1,"column":1559}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"success","original":{"line":129,"column":11},"generated":{"line":1,"column":1564}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"finalAddresses","original":{"line":129,"column":19},"generated":{"line":1,"column":1572}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"failure","original":{"line":125,"column":13},"generated":{"line":1,"column":1575}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"failure","original":{"line":125,"column":13},"generated":{"line":1,"column":1580}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","original":{"line":125,"column":21},"generated":{"line":1,"column":1588}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"module","original":{"line":134,"column":0},"generated":{"line":1,"column":1627}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"exports","original":{"line":134,"column":7},"generated":{"line":1,"column":1634}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"SrvPollingEvent","original":{"line":134,"column":15},"generated":{"line":1,"column":1642}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"SrvPollingEvent","original":{"line":134,"column":33},"generated":{"line":1,"column":1658}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"module","original":{"line":135,"column":0},"generated":{"line":1,"column":1660}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"exports","original":{"line":135,"column":7},"generated":{"line":1,"column":1667}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"SrvPoller","original":{"line":135,"column":15},"generated":{"line":1,"column":1675}},{"source":"../node_modules/mongodb/lib/core/sdam/srv_polling.js","name":"SrvPoller","original":{"line":135,"column":27},"generated":{"line":1,"column":1685}}],"sources":{"../node_modules/mongodb/lib/core/sdam/srv_polling.js":"'use strict';\n\nconst Logger = require('../connection/logger');\nconst EventEmitter = require('events').EventEmitter;\nconst dns = require('dns');\n/**\n * Determines whether a provided address matches the provided parent domain in order\n * to avoid certain attack vectors.\n *\n * @param {String} srvAddress The address to check against a domain\n * @param {String} parentDomain The domain to check the provided address against\n * @return {Boolean} Whether the provided address matches the parent domain\n */\nfunction matchesParentDomain(srvAddress, parentDomain) {\n  const regex = /^.*?\\./;\n  const srv = `.${srvAddress.replace(regex, '')}`;\n  const parent = `.${parentDomain.replace(regex, '')}`;\n  return srv.endsWith(parent);\n}\n\nclass SrvPollingEvent {\n  constructor(srvRecords) {\n    this.srvRecords = srvRecords;\n  }\n\n  addresses() {\n    return new Set(this.srvRecords.map(record => `${record.name}:${record.port}`));\n  }\n}\n\nclass SrvPoller extends EventEmitter {\n  /**\n   * @param {object} options\n   * @param {string} options.srvHost\n   * @param {number} [options.heartbeatFrequencyMS]\n   * @param {function} [options.logger]\n   * @param {string} [options.loggerLevel]\n   */\n  constructor(options) {\n    super();\n\n    if (!options || !options.srvHost) {\n      throw new TypeError('options for SrvPoller must exist and include srvHost');\n    }\n\n    this.srvHost = options.srvHost;\n    this.rescanSrvIntervalMS = 60000;\n    this.heartbeatFrequencyMS = options.heartbeatFrequencyMS || 10000;\n    this.logger = Logger('srvPoller', options);\n\n    this.haMode = false;\n    this.generation = 0;\n\n    this._timeout = null;\n  }\n\n  get srvAddress() {\n    return `_mongodb._tcp.${this.srvHost}`;\n  }\n\n  get intervalMS() {\n    return this.haMode ? this.heartbeatFrequencyMS : this.rescanSrvIntervalMS;\n  }\n\n  start() {\n    if (!this._timeout) {\n      this.schedule();\n    }\n  }\n\n  stop() {\n    if (this._timeout) {\n      clearTimeout(this._timeout);\n      this.generation += 1;\n      this._timeout = null;\n    }\n  }\n\n  schedule() {\n    clearTimeout(this._timeout);\n    this._timeout = setTimeout(() => this._poll(), this.intervalMS);\n  }\n\n  success(srvRecords) {\n    this.haMode = false;\n    this.schedule();\n    this.emit('srvRecordDiscovery', new SrvPollingEvent(srvRecords));\n  }\n\n  failure(message, obj) {\n    this.logger.warn(message, obj);\n    this.haMode = true;\n    this.schedule();\n  }\n\n  parentDomainMismatch(srvRecord) {\n    this.logger.warn(\n      `parent domain mismatch on SRV record (${srvRecord.name}:${srvRecord.port})`,\n      srvRecord\n    );\n  }\n\n  _poll() {\n    const generation = this.generation;\n    dns.resolveSrv(this.srvAddress, (err, srvRecords) => {\n      if (generation !== this.generation) {\n        return;\n      }\n\n      if (err) {\n        this.failure('DNS error', err);\n        return;\n      }\n\n      const finalAddresses = [];\n      srvRecords.forEach(record => {\n        if (matchesParentDomain(record.name, this.srvHost)) {\n          finalAddresses.push(record);\n        } else {\n          this.parentDomainMismatch(record);\n        }\n      });\n\n      if (!finalAddresses.length) {\n        this.failure('No valid addresses found at host');\n        return;\n      }\n\n      this.success(finalAddresses);\n    });\n  }\n}\n\nmodule.exports.SrvPollingEvent = SrvPollingEvent;\nmodule.exports.SrvPoller = SrvPoller;\n"},"lineCount":null}},"error":null,"hash":"0c782a4c2e5d88b465915ef411ebb1bd","cacheData":{"env":{}}}